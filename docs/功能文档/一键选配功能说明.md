# 一键选配功能说明

## 功能概述

将原来的两步操作（生成推荐 + 选配分配）合并为一个按钮"执行个体选配"，实现一键完成整个选配流程。

## 操作流程

### 1. 准备工作
- 选择项目
- 在分组预览中勾选需要选配的组
- 在冻精预览中设置公牛库存

### 2. 执行选配
- 点击"执行个体选配"按钮
- 系统自动执行以下步骤：
  1. 加载数据（10%）
  2. 母牛分组（20%）
  3. 生成推荐矩阵（40%）
  4. 执行选配分配（60%）
  5. 生成最终报告（80%）
  6. 保存报告（90%）

### 3. 查看结果
- 选配完成后，生成"个体选配报告.xlsx"
- 可选择直接打开查看

## 技术实现

### CompleteMatingExecutor
完整的选配执行器，整合了：
- GroupManager：分组管理
- MatrixRecommendationGenerator：推荐生成
- CycleBasedMatcher：选配分配

### 核心流程
```python
def execute(self, bull_inventory, ...):
    # 1. 加载数据
    recommendation_generator.load_data()
    
    # 2. 执行分组
    grouped_cows = group_manager.group_cows(...)
    
    # 3. 生成推荐矩阵
    matrices = recommendation_generator.generate_matrices()
    
    # 4. 执行分配
    allocation_df = matcher.perform_allocation(...)
    
    # 5. 生成最终报告
    final_report = self._generate_final_report(...)
    
    # 6. 保存报告
    report_path.to_excel(...)
```

## 最终报告格式

生成的"个体选配报告.xlsx"包含以下列：

| 表头 | 说明 |
|------|------|
| 母牛号 | 母牛标识 |
| 分组 | 分组名称（如"后备牛第1周期+性控"）|
| 1选性控 | 性控公牛第1选择 |
| 2选性控 | 性控公牛第2选择 |
| 3选性控 | 性控公牛第3选择 |
| 1选常规 | 常规公牛第1选择 |
| 2选常规 | 常规公牛第2选择 |
| 3选常规 | 常规公牛第3选择 |
| 胎次 | 泌乳次数 |
| 本胎次奶厅高峰产量 | 峰值产奶量 |
| 305奶量 | 305天产奶量 |
| 泌乳天数 | DIM |
| 繁育状态 | 繁殖状态 |
| 母牛指数得分 | 育种指数 |
| 品种 | 品种信息 |
| 父亲 | 父亲ID |
| 外祖父 | 母外祖父ID |
| 母亲 | 母亲ID |
| 外曾外祖父 | 母外曾外祖父ID |
| 产犊日期 | 最近产犊日期 |
| 出生日期 | 出生日期 |
| 数据提取日期 | 报告生成日期 |
| 月龄 | 计算得出的月龄 |
| 配次 | 已配种次数 |

## 分组排序顺序

报告中的数据按以下顺序排序：
1. 后备牛第1周期+性控
2. 后备牛第1周期+非性控
3. 后备牛第2周期+性控
4. 后备牛第2周期+非性控
5. 后备牛第3周期+性控
6. 后备牛第3周期+非性控
7. 后备牛第4周期+性控
8. 后备牛第4周期+非性控
9. 成母牛未孕牛+性控
10. 成母牛未孕牛+非性控
11. 后备牛难孕牛+非性控
12. 成母牛难孕牛+非性控
13. 后备牛已孕牛+非性控
14. 成母牛已孕牛+非性控

## 与旧版本的区别

### 旧版本（两步操作）
1. 点击"生成选配推荐" → 生成推荐矩阵
2. 点击"选配分配" → 基于推荐进行分配

### 新版本（一键完成）
1. 点击"执行个体选配" → 自动完成全流程

### 优势
- 操作简化，用户体验更好
- 避免中间步骤出错
- 确保数据一致性
- 生成符合要求的最终报告

---
更新日期：2024-01-30
版本：1.0