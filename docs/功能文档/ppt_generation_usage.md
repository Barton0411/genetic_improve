# PPT生成功能使用说明

## 概述

PPT生成功能用于自动生成牧场遗传改良项目专项服务报告，包含系谱分析、遗传评估、体型评定和公牛使用分析等内容。

## 功能架构

### 模块结构
```
core/report/
├── __init__.py                 # 模块初始化
├── ppt_generator.py           # PPT生成主模块
├── data_preparation.py        # 数据准备模块
└── slide_generators/          # 幻灯片生成器
    ├── __init__.py
    ├── base.py               # 基类
    ├── title_toc.py          # 标题和目录
    ├── pedigree_analysis.py  # 系谱分析
    ├── genetic_evaluation.py # 遗传评估
    ├── linear_score.py       # 体型评定
    └── bull_usage.py         # 公牛使用
```

### 配置文件
- `config/trait_translations.json` - 性状中英文对照表和阈值配置

## 使用流程

### 1. 前置条件
生成PPT前需要完成以下数据准备：

#### 必需的Excel文件
- `结果-指数排名结果.xlsx` - 母牛指数排名
- `结果-母牛关键性状指数.xlsx` - 母牛关键性状
- `结果-系谱识别情况分析.xlsx` - 系谱识别率
- `结果-牛群关键性状年度变化.xlsx` - 性状年度变化
- `在群牛只净利润值分布.xlsx` - NM$分布
- `结果-冻精使用趋势图.xlsx` - 冻精使用趋势

#### 必需的图片文件
- `NM$_年份正态分布.png` - NM$正态分布图
- `育种指数得分_年份正态分布.png` - 育种指数正态分布图
- `结果-牛群关键性状进展图/` - 各性状进展图文件夹

### 2. 生成步骤

#### 在GUI中使用
1. 打开主程序，选择项目
2. 点击"生成报告"功能页
3. 点击"生成PPT报告"按钮
4. 如果缺少必要文件，系统会提示并可选择自动生成
5. 输入牧场名称
6. 等待生成完成
7. 选择是否立即打开查看

#### 程序化使用
```python
from core.report.ppt_generator import PPTGenerator

# 创建生成器
generator = PPTGenerator(output_folder="./output", username="张三")

# 生成报告
success = generator.generate_report()
```

## PPT内容结构

### 1. 基础信息
- 标题页 - 牧场名称、用户、日期
- 目录页 - 四大模块导航

### 2. 牧场系谱记录分析
- 系谱完整性分析 - 识别率统计表
- 未识别牛只明细 - 手动填写
- 系谱记录准确性 - 手动填写

### 3. 牛群遗传数据评估
- 关键育种性状分析 - 年度变化表
- NM$分布情况分析 - 柱状图、饼图、表格
- NM$正态分布分析 - 分布图
- 育种指数正态分布分析 - 分布图
- 关键性状进展分析 - 各性状进展图

### 4. 牛群体型外貌评定
- 体型外貌线性评分 - 手动制作
- 体型外貌缺陷性状占比 - 手动制作
- 缺陷性状具体情况 - 手动制作
- 体型外貌进展情况 - 手动制作

### 5. 牧场公牛使用分析
- 公牛使用整体情况 - 基于配种记录
- 公牛使用明细 - 分年份展示
- 公牛使用进展 - 趋势图
- 公牛使用散点图 - 分布图

## 自定义配置

### 修改性状翻译
编辑 `config/trait_translations.json` 文件：
```json
{
  "traits": {
    "TPI": "育种综合指数",
    "NM$": "净利润值",
    // 添加或修改翻译
  }
}
```

### 修改阈值
在同一配置文件中：
```json
{
  "thresholds": {
    "父号识别率": {
      "warning": 90.0,  // 低于此值显示红色
      "unit": "%"
    }
  }
}
```

## 常见问题

### Q: 提示缺少数据文件怎么办？
A: 需要先运行相应的分析功能生成数据：
- 系谱识别分析
- 母牛关键性状计算
- 母牛指数排名
- 正态分布图生成

### Q: 部分页面显示"需手动整理"？
A: 体型外貌评定部分目前需要手动制作，后续版本将实现自动化。

### Q: 如何使用PPT模板？
A: 将PPT模板文件放在输出文件夹中，文件名包含"template"即可自动识别。

### Q: 生成的PPT在哪里？
A: 默认保存在：`项目文件夹/analysis_results/牧场名称牧场遗传改良项目专项服务报告.pptx`

## 开发说明

### 添加新的幻灯片
1. 在 `slide_generators` 中创建新的生成器类
2. 继承 `BaseSlideGenerator`
3. 实现 `generate_all_slides` 方法
4. 在主生成器中调用

### 添加新的数据源
1. 在 `DataPreparation` 中添加文件定义
2. 实现数据验证逻辑
3. 在对应的幻灯片生成器中使用

## 后续改进计划

1. **自动化体型评定部分** - 集成体型评分数据
2. **增强公牛使用分析** - 更详细的配种记录分析
3. **添加数据验证** - 更严格的数据完整性检查
4. **支持批量生成** - 多个牧场批量处理
5. **自定义报告内容** - 允许选择包含的章节