# Excel综合报告生成实施方案 v1.2

**文档版本:** v1.2
**创建时间:** 2025-10-10
**基于需求:** 重新规划配种记录相关分析Sheet
**状态:** 规划中

---

## 📋 版本变更说明 (v1.1 → v1.2)

### 主要变更

**Sheet结构重组：**
- ✅ Sheet 1-4 保持不变（已完成）
- 🔄 Sheet 5-8 重新规划（聚焦配种记录分析）
- ➕ 新增Sheet 9-11（已用公牛性状分析）
- 🔄 Sheet 12-13 重命名（备选公牛和选配结果）

**变更原因：**
1. 将配种记录相关的分析集中管理（隐性基因、近交系数）
2. 突出已用公牛的育种性状分析（汇总+明细）
3. 更清晰的逻辑结构：牛群分析 → 配种分析 → 公牛分析 → 选配结果

---

## 📊 Sheet结构总览 v1.2

| Sheet | 名称 | 状态 | 包含内容 |
|-------|------|------|---------|
| 1 | 牧场基础信息 | ✅ 已完成 | 汇总表 + 2个饼图 |
| 2 | 牧场牛群原始数据 | ✅ 已完成 | 原始母牛数据明细 |
| 3 | 系谱识别分析 | ✅ 已完成 | 汇总表 + 3个饼图 |
| 4 | 全群母牛系谱识别明细 | ✅ 已完成 | 系谱识别明细表 |
| 5 | 年份汇总与性状进展 | ✅ 已完成 | 育种性状年份汇总 + 折线图 |
| 6 | NM$分布分析 | ✅ 已完成 | NM$正态分布图 + 统计 |
| 7 | TPI分布分析 | ✅ 已完成 | TPI正态分布图 + 统计 |
| 8 | 育种性状明细 | ✅ 已完成 | 全群母牛育种性状明细表 |
| 9 | 母牛指数分布分析 | ✅ 已完成 | 母牛指数正态分布图 + 统计 |
| 10 | 母牛指数排名明细 | ✅ 已完成 | 母牛指数排名明细表 |
| 11 | 配种记录-隐性基因分析 | ✅ 已完成 | 2个汇总表（全部年份+近12个月） |
| 12 | 配种记录-近交系数分析 | ✅ 已完成 | 2个分布表+4个图表+年份趋势表 |
| 13 | 配种记录明细 | ✅ 已完成 | 配种记录明细表（原始数据） |
| 14 | 已用公牛性状汇总分析 | ✅ 已完成 | 过去3年汇总表 + 各性状折线图 |
| 15 | 已用公牛性状明细 | ✅ 已完成 | 按年份/类型分多个明细表 |
| 16 | 备选公牛排名 | ✅ 已完成 | 按育种指数排名 + 主要性状值 |
| 17 | 选配推荐结果 | ✅ 已完成 | 选配推荐明细表 |

---

## 📋 待实现Sheet详细设计

### Sheet 11: 配种记录-隐性基因分析 ⭐新规划

**包含内容:** 2个隐性基因纯合汇总表（全部年份 + 近12个月）

#### 5.1 隐性基因纯合汇总表（全部配种记录年份）

**表格格式:**
| 基因名称 | 翻译 | 纯合配次 | 占总配种比例 | 仅公牛携带配次 | 占比 | 仅母牛父亲携带配次 | 占比 | 数据缺少配次 | 占比 |
|---------|-----|---------|------------|--------------|-----|----------------|-----|------------|-----|
| HH1 | 单倍体不育1 | 5 | 1.2% | 45 | 10.5% | 38 | 8.9% | 12 | 2.8% |
| HH2 | 单倍体不育2 | 2 | 0.5% | 28 | 6.5% | 22 | 5.1% | 8 | 1.9% |
| HH3 | 单倍体不育3 | 1 | 0.2% | 15 | 3.5% | 12 | 2.8% | 5 | 1.2% |
| HH4 | 单倍体不育4 | 0 | 0.0% | 8 | 1.9% | 6 | 1.4% | 3 | 0.7% |
| HH5 | 单倍体不育5 | 3 | 0.7% | 22 | 5.1% | 18 | 4.2% | 7 | 1.6% |
| HH6 | 单倍体不育6 | 1 | 0.2% | 12 | 2.8% | 9 | 2.1% | 4 | 0.9% |
| BLAD | 白细胞黏附缺陷症 | 0 | 0.0% | 2 | 0.5% | 1 | 0.2% | 0 | 0.0% |
| Brachyspina | 短脊椎症 | 0 | 0.0% | 8 | 1.9% | 5 | 1.2% | 1 | 0.2% |
| ... | ... | ... | ... | ... | ... | ... | ... | ... | ... |
| MW | 早发肌无力 | 0 | 0.0% | 3 | 0.7% | 2 | 0.5% | 0 | 0.0% |

**基因列表（共16个）及中文翻译:**
- **HH系列**:
  - HH1-HH6（单倍体不育1-6）
- **其他遗传缺陷**:
  - BLAD（白细胞黏附缺陷症）
  - Brachyspina（短脊椎症）
  - CVM（牛脊椎畸形综合征）
  - Cholesterol deficiency（胆固醇缺乏症）
  - Chondrodysplasia（软骨发育不良）
  - Citrullinemia（瓜氨酸血症）
  - DUMPS（尿苷单磷酸合成酶缺乏症）
  - Factor XI（凝血因子XI缺乏症）
  - MW（早发肌无力）
  - Mulefoot（并趾症）

**基因排序规则:**
- HH系列基因在前（按HH1-HH6顺序）
- 其他遗传缺陷在后（按字母顺序）

**格式化规则:**
- **纯合配次、占比**: 红色背景 RGB(255, 199, 206)（最高风险）
- **仅公牛携带配次、占比**: 黄色背景 RGB(255, 235, 156)（中风险）
- **仅母牛父亲携带配次、占比**: 橙色背景 RGB(255, 217, 102)（中低风险）
- **数据缺少配次、占比**: 浅灰色背景 RGB(217, 217, 217)（数据缺失）
- **不需要合计行**

#### 5.2 隐性基因纯合汇总表（近12个月配种记录）

**表头格式:**
```
隐性基因纯合汇总表——YYYY年MM月DD日-YYYY年MM月DD日
```

**表格格式:** （与5.1相同，包含所有16个基因）
| 基因名称 | 纯合配次 | 占总配种比例 | 仅公牛携带配次 | 占比 | 仅母牛父亲携带配次 | 占比 | 数据缺少配次 | 占比 |
|---------|---------|------------|--------------|-----|----------------|-----|------------|-----|
| HH1 | 2 | 1.5% | 18 | 13.2% | 15 | 11.0% | 5 | 3.7% |
| HH2 | 1 | 0.7% | 12 | 8.8% | 9 | 6.6% | 3 | 2.2% |
| ... | ... | ... | ... | ... | ... | ... | ... | ... |
| MW | 0 | 0.0% | 1 | 0.7% | 1 | 0.7% | 0 | 0.0% |

**格式化规则:** （与5.1相同）
**不需要合计行**

**数据来源:**
- 文件: `已配公牛_近交系数及隐性基因分析结果_最近一次.xlsx`
- 关键列:
  - `配种日期`: 用于筛选近12个月数据
  - `基因列` (如HH1, BLAD, CVM等): 基因风险状态值

**基因自动识别逻辑:**
1. 从数据文件中自动识别所有基因列（不带(母)(公)后缀的列）
2. 验证每个基因列存在（有对应的(母)和(公)列）
3. 排序：HH系列在前，其他基因按字母顺序在后

**数据统计逻辑（基于基因列的状态值）:**

直接读取基因列的状态值进行统计，状态值映射：

| 状态值 | 统计类别 | 说明 |
|--------|---------|------|
| `'高风险'` | 纯合配次 | 母牛父亲和公牛都携带该基因，后代25%概率发病 |
| `'仅公牛携带'` | 仅公牛携带配次 | 仅公牛携带，后代不发病但可能携带 |
| `'仅母牛父亲携带'` | 仅母牛父亲携带配次 | 母牛可能携带，后代可能携带 |
| `'缺少公牛信息'` | 数据缺少配次 | 公牛基因信息缺失 |
| `'缺少母牛父亲信息'` | 数据缺少配次 | 母牛父亲基因信息缺失 |
| `'缺少双方信息'` | 数据缺少配次 | 双方基因信息都缺失 |
| `'-'` | 安全配次（不统计） | 不携带该基因，安全 |

**时间筛选:**
- **近12个月**: `配种日期 >= 今天 - 365天`

**风险等级说明:**
- **纯合风险（红色）**: 后代有25%概率发病，最高风险
- **仅公牛携带（黄色）**: 后代不发病但可能携带，中风险
- **仅母牛父亲携带（橙色）**: 母牛可能携带，后代可能携带，中低风险
- **数据缺少（灰色）**: 无法判断风险，需要补充数据

**实现状态:**
- ✅ 数据收集器已实现 (`gene_collector.py`)
  - ✅ 自动识别所有16个基因
  - ✅ 基因中文翻译映射
  - ✅ 按文件名时间戳选择最新文件
  - ✅ 全部年份和近12个月数据统计
  - ✅ 总配次统计
- ✅ Sheet构建器已实现 (`sheet5_builder.py`)
  - ✅ 10列表格（含翻译列）
  - ✅ 颜色编码风险等级
  - ✅ 标题显示总配次
  - ✅ 日期格式化

---

### Sheet 12: 配种记录-近交系数分析 ✅ 已完成

#### 6.1 近交系数分布汇总表（全部配种记录年份）

**表格格式:**
| 近交系数区间 | 配种头次 | 占比 | 风险等级 |
|------------|---------|-----|---------|
| < 3.125% | 856 | 68.5% | 低 |
| 3.125% - 6.25% | 285 | 22.8% | 中 |
| 6.25% - 12.5% | 98 | 7.8% | 高 |
| > 12.5% | 11 | 0.9% | 极高 |
| **总计** | **1250** | **100%** | - |

**格式化规则:**
- > 12.5%: 深红色背景 #FF0000（极高风险）
- 6.25-12.5%: 红色背景 #FFC7CE（高风险）
- 3.125-6.25%: 黄色背景 #FFEB9C（中风险）
- < 3.125%: 浅蓝色背景 #9BC2E6（低风险）

#### 6.2 近交系数分布汇总表（近12个月）

**表头格式:**
```
近交系数分布汇总表——YYYY年MM月DD日至YYYY年MM月DD日（共XXX配次）
```

**表格格式:** 同6.1

#### 6.3 近交系数分布图表

**每个时间段（全部年份、近12个月）包含2个图表：**

**图表1: 分布柱状图**
- X轴: 近交系数区间
- Y轴: 配种头次
- 柱子颜色与风险等级一致（浅蓝、黄、红、深红）
- 图表宽度: 13（高度×4/3）
- 位置: 与表格第一行平齐

**图表2: 风险等级占比饼图**
- 扇形颜色与风险等级一致
- 位置: 与表格第一行平齐，横向间隔11列

#### 6.4 按年份近交系数趋势

**表格格式:**
| 年份 | 总配种次数 | 高风险配种数（6.25%-12.5%） | 高风险占比 | 极高风险配种数（>12.5%） | 极高风险占比 |
|-----|----------|--------------------------|-----------|-----------------------|-------------|
| 2020 | 245 | 28 | 11.4% | 5 | 2.0% |
| 2021 | 268 | 25 | 9.3% | 3 | 1.1% |
| 2022 | 289 | 22 | 7.6% | 2 | 0.7% |
| 2023 | 312 | 18 | 5.8% | 1 | 0.3% |
| 2024 | 136 | 6 | 4.4% | 0 | 0.0% |

**格式化规则:**
- 高风险和极高风险数量>0时，标红加粗

**数据来源:**
- 文件: `已配公牛_近交系数及隐性基因分析结果_*.xlsx`
- 关键列: `配种日期`, `后代近交系数`

**实现状态:**
- ✅ 数据收集器已实现 (`breeding_inbreeding_collector.py`)
  - ✅ 全部年份和近12个月数据统计
  - ✅ 4个区间分布统计
  - ✅ 按年份趋势分析（区分高风险和极高风险）
- ✅ Sheet构建器已实现 (`sheet6_builder.py`)
  - ✅ 2个分布表（全部年份+近12个月）
  - ✅ 4个图表（2个柱状图+2个饼图）
  - ✅ 图表颜色与风险等级对应
  - ✅ 年份趋势表
  - ✅ 列宽自动调整

---

### Sheet 13: 配种记录-隐性基因及近交系数明细 ✅ 已完成

#### 7.1 配种记录综合明细表

**数据内容:**
直接复制"已配公牛_近交系数及隐性基因分析结果_*.xlsx"文件的所有数据（190行×57列）

**包含列（共57列）:**
1. 基础信息: 母牛号、配种日期、父号、原始父号、配种公牛号、原始公牛号
2. 近交系数: 近交系数、后代近交系数、后代近交详情
3. 隐性基因（16个基因，每个3列）:
   - HH1, HH1(母), HH1(公)
   - HH2, HH2(母), HH2(公)
   - HH3, HH3(母), HH3(公)
   - HH4, HH4(母), HH4(公)
   - HH5, HH5(母), HH5(公)
   - HH6, HH6(母), HH6(公)
   - BLAD, BLAD(母), BLAD(公)
   - Chondrodysplasia, Chondrodysplasia(母), Chondrodysplasia(公)
   - Citrullinemia, Citrullinemia(母), Citrullinemia(公)
   - DUMPS, DUMPS(母), DUMPS(公)
   - Factor XI, Factor XI(母), Factor XI(公)
   - CVM, CVM(母), CVM(公)
   - Brachyspina, Brachyspina(母), Brachyspina(公)
   - Mulefoot, Mulefoot(母), Mulefoot(公)
   - Cholesterol deficiency, Cholesterol deficiency(母), Cholesterol deficiency(公)
   - MW, MW(母), MW(公)

**格式化规则:**
- 表头: 应用统一的表头样式
- 数据: 居中对齐
- 列宽自动调整:
  - 母牛号、配种公牛号: 15
  - 配种日期: 12
  - 带括号的基因列: 10
  - 后代近交详情: 30
  - 其他列: 12

**数据来源:**
- 文件: `已配公牛_近交系数及隐性基因分析结果_*.xlsx`
- 读取: 所有行和所有列（原样复制）

**实现状态:**
- ✅ 数据收集器已实现 (`breeding_detail_collector.py`)
  - ✅ 读取最新的分析结果文件
  - ✅ 返回完整DataFrame
- ✅ Sheet构建器已实现 (`sheet7_builder.py`)
  - ✅ 直接复制所有数据
  - ✅ 表头样式应用
  - ✅ 列宽自动调整
  - ✅ 冻结首行

---

### Sheet 14: 已用公牛性状汇总分析 ⭐新规划

#### 8.1 过去5年已用公牛性状汇总表

**表格格式:**
| 年份 | 使用公牛数 | 配种头次 | 平均NM$ | 平均TPI | 平均产奶PTA | 平均乳脂PTA | 平均乳蛋白PTA | 平均SCS | 平均DPR | 平均繁殖力 | ... |
|-----|----------|---------|---------|---------|-----------|-----------|------------|---------|---------|-----------|-----|
| 2020 | 45 | 856 | 425 | 2280 | 1150 | 48 | 42 | 2.85 | 1.2 | 0.8 | ... |
| 2021 | 52 | 923 | 445 | 2350 | 1200 | 52 | 45 | 2.78 | 1.5 | 1.1 | ... |
| 2022 | 58 | 1012 | 468 | 2420 | 1250 | 55 | 48 | 2.72 | 1.8 | 1.4 | ... |
| 2023 | 62 | 1125 | 492 | 2485 | 1300 | 58 | 50 | 2.68 | 2.0 | 1.6 | ... |
| 2024 | 48 | 685 | 515 | 2550 | 1350 | 60 | 52 | 2.65 | 2.2 | 1.8 | ... |
| **平均** | **53** | **920** | **469** | **2417** | **1250** | **55** | **47** | **2.74** | **1.7** | **1.3** | **...** |

**数据来源:**
- 配种记录（公牛使用信息）
- 公牛库育种值数据
- 按年份统计汇总

#### 8.2 各性状进展折线图

**图表布局:** 多个折线图垂直排列

**图表1: NM$进展折线图**
- X轴: 年份（2020-2024）
- Y轴: 平均NM$
- 显示年均增长率

**图表2: TPI进展折线图**
- X轴: 年份
- Y轴: 平均TPI
- 显示年均增长率

**图表3: 产奶PTA进展折线图**
- X轴: 年份
- Y轴: 平均产奶PTA
- 显示年均增长率

**图表4: 乳成分进展折线图**（双Y轴）
- X轴: 年份
- Y轴1: 平均乳脂PTA
- Y轴2: 平均乳蛋白PTA
- 两条折线

**图表5: 体细胞和繁殖力进展折线图**（双Y轴）
- X轴: 年份
- Y轴1: 平均SCS
- Y轴2: 平均DPR
- 两条折线

#### 8.3 性状进展数据表

**表格格式:**
| 性状 | 2020-2021增长 | 2021-2022增长 | 2022-2023增长 | 2023-2024增长 | 年均增长 | 5年累计增长 |
|-----|-------------|-------------|-------------|-------------|---------|-----------|
| NM$ | +20 | +23 | +24 | +23 | +22.5 | +90 |
| TPI | +70 | +70 | +65 | +65 | +67.5 | +270 |
| 产奶PTA | +50 | +50 | +50 | +50 | +50 | +200 |
| 乳脂PTA | +4 | +3 | +3 | +2 | +3 | +12 |
| 乳蛋白PTA | +3 | +3 | +2 | +2 | +2.5 | +10 |

---

### Sheet 15: 已用公牛性状明细 ⭐新规划

#### 9.1 按年份/类型分组的明细表

**表格结构:** 每个年份-类型组合创建一个独立表格

**2024年 - 常规冻精使用公牛明细**

| 公牛NAAB号 | 使用支数 | NM$ | TPI | 产奶PTA | 乳脂PTA | 乳蛋白PTA | SCS | DPR | 繁殖力 | 隐性基因 |
|-----------|---------|-----|-----|---------|---------|----------|-----|-----|-------|---------|
| 001HO12345 | 85 | 545 | 2680 | 1420 | 65 | 55 | 2.58 | 2.5 | 2.1 | HH1 |
| 001HO23456 | 68 | 520 | 2650 | 1380 | 62 | 52 | 2.62 | 2.3 | 1.9 | - |
| 001HO34567 | 52 | 498 | 2580 | 1350 | 58 | 50 | 2.68 | 2.1 | 1.7 | HH2 |
| ... | ... | ... | ... | ... | ... | ... | ... | ... | ... | ... |
| **数据库最高值** | - | **750** | **3200** | **1800** | **85** | **75** | **2.20** | **3.5** | **3.0** | - |
| **数据库最低值** | - | **-100** | **1500** | **600** | **20** | **15** | **3.50** | **-2.0** | **-2.0** | - |
| **本组平均值** | - | **521** | **2637** | **1383** | **62** | **52** | **2.63** | **2.3** | **1.9** | - |

**2024年 - 性控冻精使用公牛明细** (同上格式)

**2023年 - 常规冻精使用公牛明细** (同上格式)

**2023年 - 性控冻精使用公牛明细** (同上格式)

... (依次展示其他年份)

**表格特点:**
- 每个年份-类型组合独立一个表
- 表格末尾3行显示：数据库最高值、最低值、本组平均值
- 按使用支数降序排列
- 隐性基因携带用橙色标记

**数据来源:**
- 配种记录（统计使用支数）
- 公牛库育种值
- 公牛库隐性基因

---

### Sheet 16: 备选公牛排名 ⭐新规划

#### 10.1 按育种指数排名表

**表格格式:**
| 排名 | 公牛NAAB号 | 公牛名称 | 育种指数 | NM$ | TPI | 产奶PTA | 乳脂PTA | 乳蛋白PTA | SCS | DPR | 繁殖力 | 隐性基因 | 可用库存 |
|-----|-----------|---------|---------|-----|-----|---------|---------|----------|-----|-----|-------|---------|---------|
| 1 | 001HO67890 | BULL-A | 98.5 | 680 | 2950 | 1520 | 72 | 62 | 2.45 | 2.8 | 2.4 | - | 50 |
| 2 | 001HO78901 | BULL-B | 96.2 | 650 | 2880 | 1480 | 68 | 58 | 2.52 | 2.6 | 2.2 | HH1 | 35 |
| 3 | 001HO89012 | BULL-C | 94.8 | 625 | 2820 | 1450 | 65 | 56 | 2.58 | 2.5 | 2.0 | - | 42 |
| ... | ... | ... | ... | ... | ... | ... | ... | ... | ... | ... | ... | ... | ... |

**格式化规则:**
- 育种指数 > 95: 绿色背景（优秀）
- 育种指数 90-95: 白色背景（良好）
- 育种指数 < 90: 黄色背景（一般）
- 携带隐性基因: 橙色标记
- 可用库存 < 10: 红色字体（库存紧张）

**数据来源:**
- 上传的备选公牛数据
- 公牛指数计算结果
- 公牛库存数据

#### 10.2 性状雷达图（可选）

**雷达图内容:**
- 选择排名前10的公牛
- 展示多维度性状对比
- 性状维度：NM$、TPI、产奶、乳脂、乳蛋白、SCS、DPR等

---

### Sheet 17: 选配推荐结果 ⭐新规划

#### 11.1 选配推荐明细表

**表格格式:**
| 母牛号 | 母牛指数 | 推荐位次 | 公牛NAAB号 | 公牛名称 | 预测后代指数 | 预测后代NM$ | 预测后代TPI | 后代近交系数 | 隐性基因风险 | 冻精类型 | 备注 |
|-------|---------|---------|-----------|---------|------------|-----------|-----------|------------|------------|---------|-----|
| C0012345 | 85.2 | 1选 | 001HO67890 | BULL-A | 91.8 | 565 | 2765 | 3.2% | 无 | 常规 | 优先推荐 |
| C0012345 | 85.2 | 2选 | 001HO78901 | BULL-B | 90.5 | 550 | 2720 | 4.1% | HH1风险 | 常规 | 备选 |
| C0012345 | 85.2 | 3选 | 001HO89012 | BULL-C | 89.2 | 538 | 2680 | 3.8% | 无 | 性控 | 备选 |
| C0012346 | 82.5 | 1选 | 001HO67890 | BULL-A | 89.5 | 548 | 2710 | 2.8% | 无 | 常规 | 优先推荐 |
| ... | ... | ... | ... | ... | ... | ... | ... | ... | ... | ... | ... |

**格式化规则:**
- 后代近交系数 > 6.25%: 红色背景
- 后代近交系数 3.125-6.25%: 黄色背景
- 有隐性基因风险: 橙色标记
- 1选推荐: 加粗
- 预测后代指数前10%: 绿色字体

**数据来源:**
- 选配推荐结果文件
- 后代指数预测
- 近交系数计算
- 隐性基因分析

#### 11.2 选配统计摘要

**表格格式:**
| 统计项 | 数值 |
|-------|-----|
| 参与选配母牛数 | 1250 |
| 成功分配1选母牛数 | 1180 |
| 成功分配2选母牛数 | 1150 |
| 成功分配3选母牛数 | 1100 |
| 1选分配率 | 94.4% |
| 使用公牛数 | 48 |
| 平均预测后代指数 | 87.5 |
| 高近交风险配对数 | 28 |
| 隐性基因风险配对数 | 156 |

---

## 🔄 数据流程图

```
项目文件夹
    ↓
配种记录文件 → Sheet 5/6/7 (隐性基因/近交系数分析)
    ↓              ↓
    ↓         公牛库数据 (育种值+隐性基因)
    ↓              ↓
    ↓         Sheet 8/9 (已用公牛性状分析)
    ↓              ↓
备选公牛数据 → Sheet 10 (备选公牛排名)
    ↓              ↓
选配推荐结果 → Sheet 11 (选配推荐结果)
```

---

## 🛠️ 实施计划

### 第一阶段：配种记录分析 (Sheet 5-7)
**预计时间:** 3-5天
**优先级:** 高

- [x] Sheet 11: 配种记录-隐性基因分析 ✅ 已完成
  - [x] 数据收集器 (gene_collector.py)
  - [x] Sheet构建器 (sheet5_builder.py)
  - [x] 2个汇总表（全部年份+近12个月）

- [x] Sheet 12: 配种记录-近交系数分析 ✅ 已完成
  - [x] 数据收集器 (breeding_inbreeding_collector.py)
  - [x] Sheet构建器 (sheet6_builder.py)
  - [x] 2个分布表 + 4个图表 + 年份趋势表

- [x] Sheet 13: 配种记录明细 ✅ 已完成
  - [x] 数据收集器 (breeding_detail_collector.py)
  - [x] Sheet构建器 (sheet7_builder.py)
  - [x] 配种记录明细表（原始数据复制）

### 第二阶段：已用公牛分析 (Sheet 8-9)
**预计时间:** 2-3天
**优先级:** 高

- [ ] Sheet 14: 已用公牛性状汇总
  - [ ] 数据收集器 (used_bulls_summary_collector.py)
  - [ ] Sheet构建器 (sheet8_builder.py)
  - [ ] 汇总表 + 折线图

- [ ] Sheet 15: 已用公牛性状明细
  - [ ] 数据收集器 (used_bulls_detail_collector.py)
  - [ ] Sheet构建器 (sheet9_builder.py)
  - [ ] 分组明细表

### 第三阶段：公牛排名和选配结果 (Sheet 10-11)
**预计时间:** 2-3天
**优先级:** 中

- [ ] Sheet 16: 备选公牛排名
  - [ ] 数据收集器 (candidate_bulls_collector.py)
  - [ ] Sheet构建器 (sheet10_builder.py)
  - [ ] 排名表

- [ ] Sheet 17: 选配推荐结果
  - [ ] 数据收集器 (mating_results_collector.py)
  - [ ] Sheet构建器 (sheet11_builder.py)
  - [ ] 选配明细表 + 统计摘要

### 第四阶段：集成测试
**预计时间:** 1-2天

- [ ] 端到端测试
- [ ] 性能优化
- [ ] 用户反馈收集

---

## 📝 文件命名规范

### Data Collectors
```
core/excel_report/data_collectors/
├── breeding_genes_collector.py        # Sheet 5
├── breeding_inbreeding_collector.py   # Sheet 6
├── breeding_detail_collector.py       # Sheet 7
├── used_bulls_summary_collector.py    # Sheet 8
├── used_bulls_detail_collector.py     # Sheet 9
├── candidate_bulls_collector.py       # Sheet 10
└── mating_results_collector.py        # Sheet 11
```

### Sheet Builders
```
core/excel_report/sheet_builders/
├── sheet5_builder.py    # 配种记录-隐性基因分析
├── sheet6_builder.py    # 配种记录-近交系数分析
├── sheet7_builder.py    # 配种记录明细
├── sheet8_builder.py    # 已用公牛性状汇总
├── sheet9_builder.py    # 已用公牛性状明细
├── sheet10_builder.py   # 备选公牛排名
└── sheet11_builder.py   # 选配推荐结果
```

---

## ✅ 待办事项

- [ ] 更新 generator.py 中的 Sheet 构建顺序
- [ ] 创建新的 data collector 占位符
- [ ] 创建新的 sheet builder 占位符
- [ ] 更新 __init__.py 导入
- [ ] 编写单元测试框架
- [ ] 准备测试数据集

---

**文档维护:** 本文档将随开发进度持续更新
