# 预测系统事件线清单（待逐步明确）

**文档版本**: v1.0
**创建日期**: 2025-11-08
**作者**: 王波臻
**状态**: 草稿 - 逐步完善中

---

## 📋 事件线总览

预测未来6年牛头数，涉及以下**关键事件线**：

```
┌─────────────────────────────────────────────────────────┐
│                    牛群数量变化                          │
│                                                         │
│  增加因素:              减少因素:                        │
│  ├─ 产犊               ├─ 淘汰                          │
│  └─ 外购（可选）       ├─ 死亡                          │
│                        ├─ 销售（可选）                  │
│                        └─ 损失                          │
│                                                         │
│  状态转变:                                              │
│  ├─ 配种 → 怀孕 → 产犊                          │
│  ├─ 犊牛 → 育成牛 → 青年牛 → 成母牛（还有胎次变化）                    │
│  ├─ 泌乳牛 → 干奶牛 → 围产牛 → 泌乳牛                  │
│  └─ 发情 → 配种 → 妊检                                 │
└─────────────────────────────────────────────────────────┘
```

---

## 1️⃣ 事件线1：产犊事件

### 1.1 事件描述
怀孕母牛达到预产期，产下犊牛

### 1.2 触发条件
```python
if cow.在胎天数 >= 277天:
    产犊()
```

### 1.3 涉及参数
| 参数名称 | 参数类型 | 说明 | 示例值 |
|---------|---------|------|--------|
| 妊娠期 | 固定值 | 从配准到产犊的天数 | 280天 |
| 接产成活率 | 百分比 | 产犊时犊牛成活的比例 | 95% |
| 母犊率（按冻精类型） | 百分比 | 产下母犊的比例 | 性控88%, 常规47% |
| 胚胎损失率 | 百分比 | 怀孕期间流产/死胎的比例 | 18% |

### 1.4 逻辑问题与矛盾

**问题1.1**: 胚胎损失率何时应用？（指确认怀孕到产犊之间的损失；接产成活指产犊后犊牛损失；犊牛饲养损失指接产成活后到这个犊牛长成大牛产犊时的，这个犊牛成长过程中的损失）

- **选项A**: 产犊时应用（怀孕280天，产犊时有18%概率流产/死胎）
- **选项B**: 怀孕期间连续应用（每个月都有一定概率流产）
- **选项C**: 配准时就扣除（受胎时就假设有18%不会成功产犊）

**问题1.2**: 接产成活率 vs 胚胎损失率，是否重复？
- 胚胎损失率：怀孕期间流产/死胎
- 接产成活率：产犊过程中的成活率
- **是否应该分开？还是合并为一个"活犊率"？**

**问题1.3**: 妊娠期是否需要随机波动？（妊娠期设定为固定的，但是还存在一个早产率的设定，他会使这部分牛的妊娠期缩短（1. 可能需要早产牛平均妊娠天数、范围，早产比例）

- 固定280天？
- 还是 280±7天随机？
- 性控冻精 vs 常规冻精妊娠期是否不同？

### 1.5 输出影响
- ✅ **牛群数量**: +母犊数
- ✅ **犊牛结构**: 新增哺乳犊牛
- ✅ **母牛状态**: 胎次+1, 重置泌乳天数, 繁育状态变为"产后未配"
- ✅ **财务**: 犊牛价值增加（按品种+性别）

### 1.6 待确认

- [ ] 胚胎损失率的应用时机
- [ ] 接产成活率是否独立于胚胎损失率
- [ ] 妊娠期是否需要随机化
- [ ] 难产、助产的处理（是否需要？）

---

## 2️⃣ 事件线2：配种与受胎事件

### 2.1 事件描述
符合配种条件的母牛进行配种，经过一定时间后妊检判定是否受胎

### 2.2 触发条件
```python
# 成母牛
if cow.胎次 > 0 and cow.产后天数 >= VWP and not cow.is_pregnant:
    配种()

# 后备牛
if cow.胎次 == 0 and cow.月龄 >= 首次配种月龄 and not cow.is_pregnant:
    配种()
```

### 2.3 涉及参数
| 参数名称 | 参数类型 | 说明 | 示例值 |
|---------|---------|------|--------|
| VWP（自愿等待期） | 天数 | 产后最早可配天数 | 60天 |
| 成母牛配准天数 | 天数 | 平均配准时的DIM | 120天 |
| 青年牛首次配种月龄 | 月龄 | 后备牛开始配种的月龄 | 14月龄 |
| 受胎率矩阵 | 二维表 | 不同配次/冻精类型/牛群类别的受胎率 | [0.58,0.48,0.38,0.28] |
| 发情周期 | 天数 | 配种间隔天数 | 21天 |
| 妊检时间 | 天数 | 配种后多久妊检 | 30-40天 |
| 禁配配次 | 整数 | 超过此配次后不再配种 | 4次 |

### 2.4 逻辑问题与矛盾

**问题2.1**: ⭐ **核心矛盾：受胎率 vs 配准天数**（已用三步法解决）
- 受胎率：每次配种的成功概率
- 配准天数：平均配准时的DIM（因为不同配种方式、不同类型（成母牛、后备牛）、他的受胎率都不一样，最终配准方式也会不同）
- **解决方案**: 三步法（受胎率 → 配准天数分布 → 个体预分配）

**问题2.2**: 不同胎次的牛，配准天数是否不同？（应该是会不同的）
- **选项A**: 所有成母牛统一用一个配准天数
- **选项B**: 按胎次分别设置（1胎牛100天，2胎牛110天，3胎+牛120天）
- **选项C**: 按胎次使用不同的受胎率，自然产生不同的配准天数

**问题2.3**: 选配策略如何分配？
- A/B/C组如何划分？
  - **选项A**: 随机分配（A组20%, B组50%, C组30%）
  - **选项B**: 按TPI排序分组（前20%用性控等）
  - **选项C**: 按胎次分组（1-2胎用性控，3+胎用常规）

**问题2.4**: 发情周期是否需要随机？
- 固定21天？
- 还是 21±3天随机？

**问题2.5**: 妊检时间是否固定？
- 固定30天？
- 还是 30-40天之间？

### 2.5 输出影响
- ✅ **配种次数**: 统计配种头次
- ✅ **冻精使用**: 按类型统计冻精用量
- ✅ **受胎头数**: 统计新增怀孕牛
- ✅ **繁育状态变化**: 产后未配 → 已配未检 → 初检孕/初检空怀
- ✅ **财务**: 冻精成本增加

### 2.6 待确认

- [x] 受胎率 vs 配准天数（已确认：三步法）
- [ ] 不同胎次的配准天数是否不同
- [ ] 选配策略的分组方式
- [ ] 发情周期是否需要随机化
- [ ] 妊检时间是否固定

---

## 3️⃣ 事件线3：淘汰事件

### 3.1 事件描述
母牛因各种原因退出牛群

### 3.2 触发条件
```python
if 满足淘汰条件():
    淘汰()
```

### 3.3 涉及参数
| 参数名称 | 参数类型 | 说明 | 示例值 |
|---------|---------|------|--------|
| 成母牛淘汰率 | 百分比/年 | 年度淘汰率 | [30%, 28%, 26%, 25%, 25%] |
| 后备牛淘汰率 | 百分比/年 | 年度淘汰率 | [8%, 8%, 8%, 8%, 8%] |
| 禁配配次 | 整数 | 超过后强制淘汰 | 4次 |
| 后备牛超龄月龄 | 月龄 | 超过此月龄未怀孕淘汰 | 30月龄 |
| 高胎次牛淘汰DIM阈值 | 天数 | 超过此DIM未怀孕淘汰 | 400天 |
| 高胎次定义 | 整数 | 几胎以上算高胎次 | 4胎 |

### 3.4 逻辑问题与矛盾

**问题3.1**: 多种淘汰规则的优先级？
```
规则1: 配种失败（禁配配次）→ 强制淘汰
规则2: 按淘汰率随机淘汰
规则3: 后备牛超龄
规则4: 高胎次牛长期不孕
规则5: 疾病淘汰（可选）
规则6: 低产淘汰（可选）
```
- **是否会重复计算？**
- **优先级顺序？**

**问题3.2**: 淘汰率如何分配到每个月？
- **选项A**: 年度淘汰率 / 12 = 月度淘汰率（均匀分布）
- **选项B**: 按季节调整（如夏季淘汰多，冬季少）
- **选项C**: 按事件触发（产后30天、配后检查空怀时）

**问题3.3**: 按淘汰率随机淘汰时，是否考虑牛的状态？
- **选项A**: 纯随机（所有牛同等概率）
- **选项B**: 加权随机（高胎次牛淘汰概率高，怀孕牛淘汰概率低）
- **选项C**: 分层随机（怀孕牛1%淘汰率，空怀牛5%淘汰率）

**问题3.4**: 淘汰时间点？
- 每月初统一判定？
- 还是特定事件后判定（配种失败后、产犊后、疾病后）？

**问题3.5**: 不同胎次的牛，淘汰率是否不同？
- **选项A**: 所有成母牛统一淘汰率30%
- **选项B**: 按胎次分别设置（1胎10%, 2胎20%, 3胎30%, 4+胎50%）

### 3.5 输出影响
- ✅ **牛群数量**: -淘汰头数
- ✅ **牛群结构**: 按胎次、状态统计淘汰
- ✅ **财务**: 淘汰牛残值收入（可选）

### 3.6 待确认

- [ ] 淘汰规则优先级和互斥关系
- [ ] 淘汰率月度分配方式
- [ ] 随机淘汰是否需要加权
- [ ] 淘汰时间点
- [ ] 是否按胎次区分淘汰率

---

## 4️⃣ 事件线4：死亡与损失事件

### 4.1 事件描述
牛只因疾病、事故等非正常原因死亡，以及犊牛的早期损失

### 4.2 触发条件
```python
# 每月随机判定
if random.random() < 月度死亡率:
    死亡()
```

### 4.3 涉及参数
| 参数名称 | 参数类型 | 说明 | 示例值 |
|---------|---------|------|--------|
| 成母牛死亡率 | 百分比/年 | 年度非正常死亡率 | 2% |
| 后备牛死亡率 | 百分比/年 | 年度非正常死亡率 | 3% |
| 犊牛损失率（哺乳期） | 百分比 | 0-2月龄损失率 | 10% |
| 犊牛损失率（断奶期） | 百分比 | 2-6月龄损失率 | 5% |
| 胚胎损失率 | 百分比 | 怀孕期间流产率 | 18% |

### 4.4 逻辑问题与矛盾

**问题4.1**: 死亡率 vs 淘汰率，是否独立？
- **选项A**: 独立计算（先淘汰30%，再死亡2%）
- **选项B**: 包含关系（淘汰率30%已包含死亡率2%）

**问题4.2**: 犊牛损失率何时应用？
- **选项A**: 出生时一次性扣除（产犊时，只有90%犊牛存活）
- **选项B**: 成长期间连续应用（每月都有损失概率）
- **选项C**: 阶段转换时应用（从哺乳犊牛变成断奶犊牛时损失10%）

**问题4.3**: 胚胎损失率 vs 接产成活率，如何协调？
- 胚胎损失率18%：怀孕期间流产
- 接产成活率95%：产犊时成活
- **关系**: 顺序应用？还是二选一？

**问题4.4**: 不同阶段的死亡率是否不同？
| 牛只类别 | 死亡率 |
|---------|-------|
| 哺乳犊牛 | 10% |
| 断奶犊牛 | 5% |
| 育成牛 | 3% |
| 青年牛 | 2% |
| 成母牛 | 2% |

### 4.5 输出影响
- ✅ **牛群数量**: -死亡/损失头数
- ✅ **财务**: 损失价值

### 4.6 待确认

- [ ] 死亡率与淘汰率的关系
- [ ] 犊牛损失率的应用时机
- [ ] 胚胎损失率、接产成活率、犊牛损失率的协调
- [ ] 是否需要按阶段区分死亡率

---

## 5️⃣ 事件线5：后备牛成长与流转事件

### 5.1 事件描述
犊牛随着月龄增长，在不同阶段之间流转，最终首次产犊成为成母牛

### 5.2 触发条件
```python
# 月龄增长
cow.月龄 += 1

# 阶段流转
if cow.月龄 达到阈值:
    升级到下一阶段()
```

### 5.3 涉及参数
| 参数名称 | 参数类型 | 说明 | 示例值 |
|---------|---------|------|--------|
| 哺乳期月龄范围 | 月龄 | 0-2月龄 | 0-2 |
| 断奶期月龄范围 | 月龄 | 2-6月龄 | 2-6 |
| 育成期月龄范围 | 月龄 | 6-14月龄 | 6-14 |
| 青年期月龄范围 | 月龄 | 14-24月龄 | 14-24 |
| 青年牛首次配种月龄 | 月龄 | 开始配种的月龄 | 14 |
| 首次产犊月龄 | 月龄 | 预计首次产犊月龄 | 24 |

### 5.4 逻辑问题与矛盾

**问题5.1**: 阶段流转是按日历月，还是按实际月龄？
- **选项A**: 按日历月（每月1号统一升级）
- **选项B**: 按实际月龄（每头牛在出生后第N天升级）

**问题5.2**: 牛只类别（哺乳犊牛/断奶犊牛/育成牛/青年牛）如何更新？
- 自动根据月龄判定？
- 还是固定时间点批量更新？

**问题5.3**: 首次产犊月龄如何预测？
- **问题**: 青年牛14月龄配种，配准天数未知，何时首次产犊？
- **三步法应用**:
  - 14月龄开始配种
  - 预分配配准月数（如4个月）
  - 配准后怀孕9.3个月
  - 首次产犊月龄 = 14 + 4 + 9.3 = 27.3月龄

**问题5.4**: 后备牛流转过程中的损失如何处理？
- 除了犊牛损失率，其他阶段还有损失吗？
- 还是只有淘汰率？

**问题5.5**: 性成熟率、配种启动率如何使用？
- **性成熟率**: 达到配种月龄后，有多少牛实际可以配种？（如90%）
- **配种启动率**: 可配种的牛中，有多少牛在本月实际配种？（如50%）
- **是否需要这两个参数？**

### 5.5 输出影响
- ✅ **牛群结构**: 各阶段后备牛数量变化
- ✅ **成母牛数量**: 后备牛首次产犊后转为成母牛
- ✅ **后备牛价值**: 随月龄增长，价值增加

### 5.6 待确认

- [ ] 阶段流转的时间规则
- [ ] 牛只类别更新方式
- [ ] 首次产犊月龄的计算方式
- [ ] 后备牛各阶段是否有独立损失率
- [ ] 是否需要性成熟率、配种启动率参数

---

## 6️⃣ 事件线6：泌乳状态转换事件

### 6.1 事件描述
成母牛在泌乳期、干奶期、围产期之间转换

### 6.2 触发条件
```python
# 产犊后 → 泌乳牛
if cow.产后天数 == 0:
    cow.牛只类别 = "泌乳牛"

# 怀孕后期或高DIM → 干奶牛
if (cow.在胎天数 > 220) or (cow.泌乳天数 > 305):
    cow.牛只类别 = "干奶牛"

# 临产前 → 围产牛
if cow.在胎天数 > 260:
    cow.牛只类别 = "围产牛"
```

### 6.3 涉及参数
| 参数名称 | 参数类型 | 说明 | 示例值 |
|---------|---------|------|--------|
| 标准泌乳天数 | 天数 | 一个泌乳周期的天数 | 305天 |
| 干奶开始在胎天数 | 天数 | 怀孕多少天开始干奶 | 220天 |
| 围产期开始在胎天数 | 天数 | 产前多少天进入围产期 | 260天（产前20天）|
| 最长泌乳天数 | 天数 | 超过此DIM强制干奶（即使未怀孕）| 400天 |

### 6.4 逻辑问题与矛盾

**问题6.1**: 未怀孕的牛，泌乳天数超过305天后如何处理？
- **选项A**: 继续泌乳，直到再次怀孕
- **选项B**: 超过400天强制干奶
- **选项C**: 超过400天淘汰

**问题6.2**: 干奶牛的定义？
- **选项A**: 已怀孕且在胎天数>220天
- **选项B**: 泌乳天数>305天（无论是否怀孕）
- **选项C**: A或B满足其一

**问题6.3**: 泌乳曲线是否需要模拟？
- 如果统计"月均产奶量"，是否需要模拟泌乳曲线？
- 还是简化为：泌乳牛日均产奶量固定（如30kg/天）？

**问题6.4**: 围产期是否单独统计？
- 围产牛是干奶牛的一个子集？
- 还是独立类别？

### 6.5 输出影响
- ✅ **牛群结构**: 泌乳牛、干奶牛、围产牛数量
- ✅ **产奶量**: 影响收益计算（如果需要）

### 6.6 待确认

- [ ] 未怀孕高DIM牛的处理
- [ ] 干奶牛的精确定义
- [ ] 是否需要模拟泌乳曲线
- [ ] 围产牛的归类方式

---

## 7️⃣ 事件线7：冻精使用与成本计算

### 7.1 事件描述
配种时使用冻精，记录使用量并计算成本

### 7.2 触发条件
```python
if 配种事件发生:
    记录冻精使用(冻精编号, 配次)
```

### 7.3 涉及参数
| 参数名称 | 参数类型 | 说明 | 示例值 |
|---------|---------|------|--------|
| 冻精价格表 | 字典 | 公牛编号 → 价格 | {"151HO04869": 80, ...} |
| 选配策略 | 分组方案 | A/B/C组的冻精分配 | A组→性控, B组→常规 |

### 7.4 逻辑问题与矛盾

**问题7.1**: 使用三步法后，如何统计冻精使用量？
- **关键**: 每头牛预分配了配准天数（对应配次）
  - 90天 → 1配成功 → 使用1支冻精
  - 111天 → 2配成功 → 使用2支冻精
  - 132天 → 3配成功 → 使用3支冻精
  - 153天 → 4配成功 → 使用4支冻精

- **问题**: 每次配种用什么冻精？
  - **选项A**: 所有配次都用同一种冻精（如性控）
  - **选项B**: 不同配次用不同冻精（如1-2配用性控，3-4配用常规）

**问题7.2**: 选配策略如何与配次关联？
```python
成母牛选配策略 = {
    "A组": {
        "占比": 0.2,
        "冻精类型": "性控",
        "配次策略": [1, 2, 3, 4]  # 1-4配都用性控
    },
    "B组": {
        "占比": 0.5,
        "冻精类型": ["性控", "性控", "常规", "常规"],  # 1-2配用性控，3-4配用常规
        "配次策略": [1, 2, 3, 4]
    },
    "C组": {
        "占比": 0.3,
        "冻精类型": "肉牛",
        "配次策略": [1, 2]  # 只配2次
    }
}
```

**问题7.3**: 冻精使用量如何从预分配配准天数推算？
```python
耳号1160: 预分配配准天数=90天 → 1配成功 → A组 → 使用1支性控冻精
耳号1389: 预分配配准天数=111天 → 2配成功 → B组 → 使用1支性控+1支性控=2支
耳号1557: 预分配配准天数=132天 → 3配成功 → B组 → 使用2支性控+1支常规=3支
```

### 7.5 输出影响
- ✅ **冻精使用量**: 按类型统计
- ✅ **冻精成本**: 使用量 × 价格

### 7.6 待确认

- [ ] 每头牛各配次使用什么冻精
- [ ] 选配策略的冻精分配规则
- [ ] 从预分配配准天数到冻精使用量的映射算法

---

## 8️⃣ 事件线8：后备牛价值评估

### 8.1 事件描述
统计后备牛的价值变化（用于投资回报分析）

### 8.2 触发条件
```python
每月统计后备牛价值 = Σ (每头后备牛价值)
```

### 8.3 涉及参数
| 参数名称 | 参数类型 | 说明 | 示例值 |
|---------|---------|------|--------|
| 犊牛价值表 | 字典 | (品种, 性别) → 价格 | {("荷斯坦","母"): 500} |
| 后备牛价值表（可选） | 字典 | 月龄 → 价格 | {6: 3000, 12: 5000, ...} |

### 8.4 逻辑问题与矛盾

**问题8.1**: 后备牛价值如何计算？
- **选项A**: 固定价格表（按月龄）
  ```python
  {6月龄: 3000, 12月龄: 5000, 18月龄: 8000, 24月龄: 12000}
  ```

- **选项B**: 成本累加法
  ```python
  价值 = 初始犊牛价值 + Σ月度饲养成本 + 配种成本
  ```

- **选项C**: 市场估值法（基于遗传指数）
  ```python
  价值 = 基础价值 × (1 + TPI系数) × 月龄系数
  ```

**问题8.2**: 新生犊牛的初始价值？
- 按品种+性别定价
- 还是按父母遗传指数定价？

**问题8.3**: 后备牛转成母牛后，价值如何变化？
- 后备牛24月龄：12000元
- 首次产犊后成母牛：15000元？
- **增值3000元是收益吗？**

### 8.5 输出影响
- ✅ **后备牛总价值**: 月度统计
- ✅ **价值变化**: 新增犊牛、成长增值、首次产犊转换

### 8.6 待确认

- [ ] 后备牛价值计算方法
- [ ] 新生犊牛初始价值定价
- [ ] 后备牛转成母牛的价值变化处理

---

## 9️⃣ 事件线9：外购与销售（可选）

### 9.1 事件描述
从外部购买牛只，或销售牛只

### 9.2 触发条件
```python
# 外购
if 需要补充牛群:
    外购牛只()

# 销售
if 淘汰牛 or 公犊:
    销售()
```

### 9.3 涉及参数
| 参数名称 | 参数类型 | 说明 | 示例值 |
|---------|---------|------|--------|
| 是否启用外购 | 布尔 | 是否考虑外购 | False |
| 外购计划 | 列表 | 按年度外购数量 | [100, 50, 0, 0, 0, 0] |
| 公犊销售价格 | 价格 | 公犊销售单价 | 300元/头 |
| 淘汰牛销售价格 | 价格 | 淘汰牛残值 | 5000元/头 |

### 9.4 逻辑问题与矛盾

**问题9.1**: 是否需要外购功能？
- 如果需要，何时触发？
- 如果不需要，可以简化

**问题9.2**: 公犊和淘汰牛是否统计销售收入？
- 您之前说成本只计算冻精和后备牛价值
- **销售收入是否也需要？**

### 9.5 输出影响
- ✅ **牛群数量**: ±外购/销售头数
- ✅ **财务**: 外购成本、销售收入

### 9.6 待确认

- [ ] 是否需要外购功能
- [ ] 是否需要销售收入统计

---

## 🔟 事件线10：牛群结构统计

### 10.1 事件描述
每月统计牛群的各种分类结构

### 10.2 统计维度

```python
月度统计 = {
    # 按胎次
    "by_parity": {0: 1800, 1: 850, 2: 700, 3: 900, ...},

    # 按类别
    "by_category": {
        "泌乳牛": 2000,
        "干奶牛": 400,
        "围产牛": 120,
        "青年牛": 520,
        "育成牛": 350,
        "断奶犊牛": 380,
        "哺乳犊牛": 430
    },

    # 按月龄（后备牛）
    "heifers_by_age": {
        "0-6m": 810,
        "6-12m": 540,
        "12-18m": 280,
        "18-24m": 170
    },

    # 按繁育状态
    "by_repro_status": {
        "复检孕": 1300,
        "已配未检": 850,
        "产后未配": 650,
        "初检孕": 250,
        "初检空怀": 30,
        "出生": 1200
    },

    # 总数
    "total": 4500,
    "cows": 2700,
    "heifers": 1800,
    "pregnant": 1550,
    "open": 1150
}
```

### 10.3 待确认

- [ ] 需要哪些统计维度
- [ ] 是否需要更细的分类（如按DIM段、按在胎天数段）

---

## 📊 事件线依赖关系图

```
时间推进（每月）
    ↓
┌───────────────────────────────────────────────────────┐
│ 1. 更新时间字段                                        │
│    - 月龄 +1                                          │
│    - 泌乳天数 +30                                      │
│    - 在胎天数 +30                                      │
│    - 产后天数 +30                                      │
└───────────────┬───────────────────────────────────────┘
                ↓
┌───────────────────────────────────────────────────────┐
│ 2. 产犊事件（在胎天数>=280）                           │
│    - 应用接产成活率                                    │
│    - 应用母犊率 → 新生母犊/公犊                        │
│    - 母牛胎次+1, DIM重置                               │
└───────────────┬───────────────────────────────────────┘
                ↓
┌───────────────────────────────────────────────────────┐
│ 3. 死亡/损失事件                                       │
│    - 成母牛/后备牛死亡（按死亡率）                     │
│    - 犊牛损失（按犊牛损失率）                          │
└───────────────┬───────────────────────────────────────┘
                ↓
┌───────────────────────────────────────────────────────┐
│ 4. 淘汰事件                                           │
│    - 配种失败强制淘汰                                  │
│    - 按淘汰率随机淘汰                                  │
│    - 超龄/长期不孕淘汰                                 │
└───────────────┬───────────────────────────────────────┘
                ↓
┌───────────────────────────────────────────────────────┐
│ 5. 配种事件（产后天数>=预分配配准天数）                 │
│    - 记录配种                                          │
│    - 分配冻精类型                                      │
│    - 标记为怀孕                                        │
│    - 统计冻精使用                                      │
└───────────────┬───────────────────────────────────────┘
                ↓
┌───────────────────────────────────────────────────────┐
│ 6. 泌乳状态更新                                        │
│    - 判定泌乳牛/干奶牛/围产牛                          │
└───────────────┬───────────────────────────────────────┘
                ↓
┌───────────────────────────────────────────────────────┐
│ 7. 后备牛流转                                          │
│    - 按月龄更新牛只类别                                │
│    - 首次产犊 → 胎次0变1                               │
└───────────────┬───────────────────────────────────────┘
                ↓
┌───────────────────────────────────────────────────────┐
│ 8. 统计本月牛群结构                                    │
│    - 按胎次/类别/月龄/繁育状态分类                     │
│    - 计算后备牛价值                                    │
│    - 计算冻精成本                                      │
└───────────────────────────────────────────────────────┘
```

---

## ✅ 下一步行动

请您逐个事件线确认：

1. **事件线1（产犊）**: 问题1.1 - 1.3
2. **事件线2（配种）**: 问题2.1 - 2.5（2.1已确认三步法）
3. **事件线3（淘汰）**: 问题3.1 - 3.5
4. **事件线4（死亡）**: 问题4.1 - 4.4
5. **事件线5（后备牛成长）**: 问题5.1 - 5.5
6. **事件线6（泌乳状态）**: 问题6.1 - 6.4
7. **事件线7（冻精使用）**: 问题7.1 - 7.3
8. **事件线8（后备牛价值）**: 问题8.1 - 8.3
9. **事件线9（外购销售）**: 问题9.1 - 9.2
10. **事件线10（统计）**: 确认统计维度

我们可以一个一个事件线讨论，确认所有逻辑后再开始编码！
