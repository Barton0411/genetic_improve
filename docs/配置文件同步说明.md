# 配置文件同步说明

**创建时间:** 2025-11-03
**目的:** 确保`.clinerules`和`.claude/commands/`保持同步

---

## 📁 当前配置文件

您的项目中有两套AI助手配置文件：

| 配置文件 | 适用工具 | 状态 |
|---------|---------|------|
| `.clinerules` | Cline | ✅ 已更新并同步 |
| `.claude/commands/release.md` | Claude Code | ✅ 已更新并同步 |

**同步时间:** 2025-11-03
**同步状态:** ✅ 两者内容已完全同步

---

## 🎯 两套配置的作用

### 1. `.clinerules` - Cline专用

**触发方式:**
```
用户："发布新版本 v1.2.0.19"
```

Cline会自动读取`.clinerules`文件并执行。

### 2. `.claude/commands/release.md` - Claude Code专用

**触发方式:**
```
/release v1.2.0.19
```

Claude Code会自动加载这个命令文件。

---

## ✅ 已同步的内容

两个配置文件都包含完整的6步发布流程：

### 第0步：确认信息
- 版本号
- 是否清理测试文件

### 第1步：分析变更内容
- 通过git log自动分析
- 自动分类：新功能、Bug修复、性能改进

### 第2步：清理测试文件
- 扫描7天未用的测试文件
- 列出清单让用户确认

### 第3步：更新文档（docs/）
- 版本历史.md
- 已完成任务.md
- 项目路线图.md
- README.md
- 其他相关文档

### 第4步：更新代码版本号
- ✅ version.py（VERSION + VERSION_HISTORY）
- ✅ version.json（version + urls + changes）⚠️ 最容易忘记
- ✅ CHANGELOG.md
- ✅ 严格的changes编写规则
- ✅ 检查清单（9项确认）

### 第5步：执行Git操作
- 添加文件
- 创建提交（规范的commit message）
- 推送到main
- 创建并推送标签
- 触发GitHub Actions

### 第6步：生成完整报告
- 版本信息
- 变更内容
- 已更新的文件
- Git操作结果
- 下一步建议

---

## 🔧 如何使用

### 如果您使用 Claude Code（当前）

```bash
/release v1.2.0.19
```

AI会自动加载`.claude/commands/release.md`并执行完整流程。

### 如果您使用 Cline

```
发布新版本 v1.2.0.19
```

Cline会自动读取`.clinerules`并执行。

### 如果配置文件不生效

使用完整提示词（两个工具都适用）：

```
发布新版本 v1.2.0.19

按照项目配置规则执行完整发布流程：
1. 自动分析git变更内容
2. 清理测试文件（先列出让我确认）
3. 更新所有docs文档（按维护规则检查清单）
4. 更新version.py、version.json、CHANGELOG.md
5. Git操作（commit, tag, push, 触发Actions）
6. 生成完整报告

请使用TodoWrite跟踪进度，不确定的先问我。
```

---

## 🔄 如何保持同步

当您修改任何一个配置文件时，记得同步另一个：

### 修改了 `.clinerules`

需要同步到 `.claude/commands/release.md`

### 修改了 `.claude/commands/release.md`

需要同步到 `.clinerules`

### 同步检查清单

- [ ] 版本更新流程的步骤数量一致
- [ ] version.json的重要性强调一致
- [ ] changes编写规则完全一致
- [ ] Git操作流程一致
- [ ] 检查清单项目一致

---

## 🎓 关键规则（两边都强调）

### ⚠️ 最容易忘记的：version.json

```json
{
  "version": "v1.2.0.19",
  "mac_download_url": "https://...",
  "win_download_url": "https://...",
  "changes": [
    "1. <b>界面</b>：具体描述",
    "2. <b>修复</b>：具体描述"
  ],
  "force_update": false
}
```

**客户端依赖此文件检查更新！**

### changes编写规则（严格遵守）

**❌ 禁止：**
- Emoji表情符号
- 颜色代码（#456ba0等）
- CSS属性名（gradient等）
- 代码文件名（main_window.py等）
- 技术术语（QSS、QPalette等）

**✅ 正确格式：**
```
1. <b>界面</b>：优化导航栏配色方案，提升视觉体验
2. <b>修复</b>：修复Excel报告中图表重叠显示问题
3. <b>优化</b>：提升数据加载速度
```

### version.py 和 version.json 的 changes 必须一致

```python
# version.py 的 VERSION_HISTORY
{
    "changes": [
        "1. <b>界面</b>：优化导航栏配色方案，提升视觉体验",
        "2. <b>修复</b>：修复Excel报告中图表重叠显示问题"
    ]
}
```

```json
// version.json 的 changes（完全相同）
{
    "changes": [
        "1. <b>界面</b>：优化导航栏配色方案，提升视觉体验",
        "2. <b>修复</b>：修复Excel报告中图表重叠显示问题"
    ]
}
```

---

## 📊 配置文件对比

| 特性 | `.clinerules` | `.claude/commands/release.md` |
|-----|--------------|------------------------------|
| **适用工具** | Cline | Claude Code |
| **触发方式** | 自动识别关键词 | `/release` 命令 |
| **内容** | ✅ 完整6步流程 | ✅ 完整6步流程 |
| **version.json强调** | ✅ 有（⚠️标记） | ✅ 有（⚠️标记） |
| **changes规则** | ✅ 详细说明 | ✅ 详细说明 |
| **检查清单** | ✅ 完整清单 | ✅ 完整清单 |
| **同步状态** | ✅ 已同步 | ✅ 已同步 |

---

## 🚀 下次发布时

### 使用Claude Code（推荐）

```bash
/release v1.2.0.19
```

### 使用Cline

```
发布新版本 v1.2.0.19
```

### 使用其他工具或配置失效

```
发布新版本 v1.2.0.19，按照项目配置规则执行完整发布流程（包括更新docs文档、version.json等所有文件）
```

---

## ✅ 验证同步成功

两个配置文件都包含以下关键内容：

- ✅ 第0步到第6步完整流程
- ✅ 自动分析git log
- ✅ 更新docs/目录下4个核心文档
- ✅ version.json强调（最容易遗漏）
- ✅ changes编写规则（无emoji、无技术细节）
- ✅ version.py和version.json的changes一致性要求
- ✅ 完整的检查清单（30+项）
- ✅ Git操作流程（5个子步骤）
- ✅ 生成完整报告

---

**最后更新:** 2025-11-03
**同步人员:** Claude Code
**下次同步:** 当任一配置文件修改时

**建议:** 将本文档加入版本控制，记录配置文件的同步历史。
