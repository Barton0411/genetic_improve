"""
版本信息管理
"""

# 版本号格式: 主版本号.次版本号.修订号.构建号 (xxx.xxx.xxx.xxx)
VERSION = "1.2.1.8"

# 版本历史（完整记录所有版本）
VERSION_HISTORY = [
    {
        "version": "1.2.1.8",
        "date": "2025-11-26",
        "author": "Development Team",
        "changes": [
            "1. <b>修复</b>：修正近交系数计算中违反Wright通径规则的问题",
            "   - 正确过滤虚拟节点（_dam、_mgd等）造成的重复节点通径",
            "   - 修正路径验证规则，只检查路径中间节点（不包括终点祖先）",
            "2. <b>优化</b>：改进共同祖先识别逻辑",
            "   - 公牛作为母牛祖先时正确计入共同祖先",
            "   - 添加空路径表示起点到自己（路径长度=0）",
            "3. <b>功能</b>：新增计算器缓存清除方法，支持系谱更新后重新计算",
            "4. <b>影响</b>：近交系数计算更准确，符合Wright通径系数理论"
        ]
    },
    {
        "version": "1.2.1.6",
        "date": "2025-11-26",
        "author": "Development Team",
        "changes": [
            "1. <b>修复</b>：修正PPT育种分析报告中9个正态分布页面的统计表格数据错误问题",
            "2. <b>修复</b>：修正不同阶段育种指数页面统计表格名称（表格3→表格5）",
            "3. <b>修复</b>：修正不同出生年份页面统计表格数据匹配逻辑，使用正向特征匹配代替负向排除",
            "4. <b>优化</b>：完善Excel标签匹配机制，精确定位S204位置的年份统计数据",
            "5. <b>修复</b>：解决同一Excel标签出现在多个位置时的数据混淆问题（S100/S144/S204）"
        ]
    },
    {
        "version": "1.2.1.5",
        "date": "2025-11-18",
        "author": "Development Team",
        "changes": [
            "1. <b>功能</b>：自动化生成页面支持小屏幕，窗口尺寸自适应分辨率，右侧内容区改为可滚动显示",
            "2. <b>优化</b>：PPT第8页“系谱识别情况汇总”按Excel动态生成行，自动删除多余模板行并保留合计行样式",
            "3. <b>功能</b>：在PPT第8页中按“可识别占比<80%”规则自动高亮粉色，包括合计行，占比异常一目了然",
            "4. <b>修复</b>：近交通径法共同祖先集合不再在集合层面合并远祖，像509HO11351这类近祖先在结果中单独展示"
        ]
    },
    {
        "version": "1.2.1.4",
        "date": "2025-11-18",
        "author": "Development Team",
        "changes": [
            "1. <b>修复</b>：修正PPT模版打包错误，使用正确的模版文件",
            "2. <b>优化</b>：macOS安装包大小优化 - 强制卸载torch等大型库",
            "3. <b>修复</b>：添加PyInstaller hooks强制排除不必要依赖",
            "4. <b>优化</b>：构建流程优化，打包前明确卸载大型依赖"
        ]
    },
    {
        "version": "1.2.1.3",
        "date": "2025-11-18",
        "author": "Development Team",
        "changes": [
            "1. <b>修复</b>：修正PPT模版打包错误，使用正确的模版文件",
            "2. <b>优化</b>：macOS安装包大小优化，从375MB降至预期的60MB左右",
            "3. <b>修复</b>：排除PyTorch等不必要的大型库（torch 239MB、pyarrow 97MB等）",
            "4. <b>优化</b>：Windows安装包同步优化，减小体积提升下载速度"
        ]
    },
    {
        "version": "1.2.1.2",
        "date": "2025-11-18",
        "author": "Development Team",
        "changes": [
            "1. <b>优化</b>：macOS安装包大小优化，从375MB降至预期的60MB左右",
            "2. <b>修复</b>：排除PyTorch等不必要的大型库（torch 239MB、pyarrow 97MB等）",
            "3. <b>优化</b>：Windows安装包同步优化，减小体积提升下载速度",
            "4. <b>修复</b>：更新对话框换行显示问题修复"
        ]
    },
    {
        "version": "1.2.1.1",
        "date": "2025-11-18",
        "author": "Development Team",
        "changes": [
            "1. <b>功能</b>：开始完善自动生成PPT，已经完成模版建设，正在逐步调整数据和结构",
            "2. <b>架构</b>：把PPT生成流程从'新建+拼接'切到'基于完整模版按页填充'",
            "3. <b>优化</b>：把1–6页的数据映射、取数逻辑和格式问题逐步纠正到了和Excel/模版完全一致",
            "4. <b>功能</b>：开始完善Part 3，从第8页'系谱识别情况汇总'入手，让行数、顺序、样式都严格跟Excel+模版对齐",
            "5. <b>修复</b>：对近交通径法里'共同祖先合并'的逻辑做了核心修正，保证像509HO11351这种近祖先能在结果里清楚展示"
        ]
    },
    {
        "version": "1.2.0.22",
        "date": "2025-11-14",
        "author": "Development Team",
        "changes": [
            "1. <b>修复</b>：修复路径查找算法，移除全局visited集合，允许同一祖先多条路径记录",
            "2. <b>修复</b>：修复通径链重复节点检查，正确过滤无效通径（如47←29←13←7→14→29→36）",
            "3. <b>优化</b>：改进路径显示格式为标准形式（公牛 ← 父系 ← 共同祖先 → 母系 → 母牛）",
            "4. <b>功能</b>：新增通径详情展示，显示前5个重要共同祖先的所有有效通径",
            "5. <b>优化</b>：路径验证增强，严格遵循Wright通径链规则（同一个体不能两次出现）",
            "6. <b>功能</b>：控制台输出有效/无效通径统计，便于调试和验证",
            "7. <b>优化</b>：界面显示优化，通径列表显示n1、n2路径长度参数",
            "8. <b>修复</b>：修复多路径到同一祖先时近交系数虚高/虚低的问题",
            "9. <b>文档</b>：完善通径链理论说明和计算示例文档"
        ]
    },
    {
        "version": "1.2.0.21",
        "date": "2025-11-14",
        "author": "Development Team",
        "changes": [
            "1. <b>修复</b>：近交系数计算步骤详情显示n₁、n₂、F_CA实际值而非默认值",
            "2. <b>优化</b>：路径信息存储增强，保存完整计算参数（n1, n2, F_CA）",
            "3. <b>功能</b>：旧格式数据兼容，动态从系谱库提取GIB值",
            "4. <b>功能</b>：智能反推路径长度，使用数学公式从贡献值计算",
            "5. <b>修复</b>：修复近交详情从Excel读取的字符串格式转换问题",
            "6. <b>优化</b>：完善公牛库更新后自动重建系谱索引机制",
            "7. <b>修复</b>：修复NAAB→REG映射缓存未及时更新导致的近交系数计算错误",
            "8. <b>优化</b>：增强系谱数据库查询，缓存未命中时直接查询本地数据库",
            "9. <b>文档</b>：完成820头母牛0.00%近交系数问题分析报告"
        ]
    },
    {
        "version": "1.2.0.20",
        "date": "2025-11-04",
        "author": "Development Team",
        "changes": [
            "1. <b>功能</b>：新增3个备选公牛分析Sheet（隐性基因、近交系数、明细表）",
            "2. <b>功能</b>：备选公牛分析支持成母牛/后备牛分组统计",
            "3. <b>功能</b>：每个备选公牛独立分析，配水平条形图对比",
            "4. <b>性能</b>：Excel明细表写入性能优化100倍（5分钟降至15秒）",
            "5. <b>性能</b>：所有明细表采用批量写入，整体报告生成时间减半",
            "6. <b>优化</b>：优化7个Sheet Builder的数据写入方式",
            "7. <b>修复</b>：修复备选公牛数据收集器的列名匹配问题",
            "8. <b>优化</b>：Excel报告版本升级至v1.3（现包含20个Sheet）"
        ]
    },
    {
        "version": "1.2.0.19",
        "date": "2025-11-03",
        "author": "Development Team",
        "changes": [
            "1. <b>修复</b>：修复增量选配时母牛育种指数被覆盖的问题",
            "2. <b>界面</b>：优化界面显示，固定使用浅色模式",
            "3. <b>文档</b>：文档体系全面重构，新增多个使用指南"
        ]
    },
    {
        "version": "1.2.0.18",
        "date": "2025-11-02",
        "author": "Development Team",
        "changes": [
            "1. <b>修复</b>：恢复个体选配导航功能（移除未实现的体型外貌评定菜单项）",
            "2. <b>优化</b>：进度条窗口现支持移动和最小化，不再强制置顶"
        ]
    },
    {
        "version": "1.2.0.17",
        "date": "2025-11-01",
        "author": "Development Team",
        "changes": [
            "1. <b>修复</b>：修正Sheet 3-2/3-3/4整体正态分布图统计表缺失问题",
            "2. <b>优化</b>：统计表格式转置，指标作为列，分组作为行，与其他统计表格式统一",
            "3. <b>优化</b>：五等份分析表转置，分组作为列，指标作为行，提高可读性",
            "4. <b>优化</b>：正态分布图Y轴范围动态调整为曲线最高点的2倍",
            "5. <b>功能</b>：统计表新增最小值、最大值指标",
            "6. <b>功能</b>：添加详细指标说明和分析建议（变异系数、Q1-Q3等）",
            "7. <b>优化</b>：正态分布图X轴范围基于每个图表数据动态计算"
        ]
    },
    {
        "version": "1.2.0.16",
        "date": "2025-10-31",
        "author": "Development Team",
        "changes": [
            "1. <b>功能</b>：Sheet 10表头国际化，使用系统标准翻译",
            "2. <b>优化</b>：进度条平滑动画，每50ms更新一次",
            "3. <b>优化</b>：进度条持续移动，避免卡住不动",
            "4. <b>优化</b>：数据收集阶段细分为9个步骤报告进度",
            "5. <b>优化</b>：Sheet 1A复制过程每100行报告一次进度",
            "6. <b>界面</b>：进度对话框窗口置顶显示",
            "7. <b>修复</b>：修正技术标准配置，FE/RFI正确区分",
            "8. <b>修复</b>：修正性状翻译，使用标准术语",
            "9. <b>修复</b>：修正数据库查询，FE数据正确从数据库补充",
            "10. <b>功能</b>：备选公牛排名包含所有技术标准性状"
        ]
    },
    {
        "version": "1.2.0.15",
        "date": "2025-10-29",
        "author": "Development Team",
        "changes": [
            "1. <b>界面</b>：优化导航栏配色方案，提升视觉体验",
            "2. <b>界面</b>：改进菜单选中状态显示效果",
            "3. <b>修复</b>：修复Excel报告中图表重叠显示问题",
            "4. <b>优化</b>：优化散点图布局排列方式"
        ]
    },
    {
        "version": "1.2.0.14",
        "date": "2025-10-28",
        "author": "Development Team",
        "changes": [
            "1. <b>修复</b>：修复数据ID格式问题，解决自动转换导致的错误",
            "2. <b>修复</b>：修复多个核心模块的数据处理逻辑",
            "3. <b>优化</b>：统一数据读取后的格式转换，确保一致性",
            "4. <b>修复</b>：修复数据合并操作中的类型转换问题",
            "5. <b>优化</b>：改进系谱分析为动态年份分组",
            "6. <b>功能</b>：系谱识别结果自动显示最近4年数据",
            "7. <b>修复</b>：彻底解决选配过程中ID格式匹配失败问题"
        ]
    },
    {
        "version": "1.2.0.13",
        "date": "2025-10-18",
        "author": "Development Team",
        "changes": [
            "1. <b>修复</b>：修复非标准NAAB号被清空的问题，保留原始编号",
            "2. <b>优化</b>：优化编号格式化功能，确保配种记录完整",
            "3. <b>功能</b>：添加标准和非标准编号统计输出",
            "4. <b>修复</b>：修复年份分组逻辑，改为动态使用当前年份",
            "5. <b>修复</b>：修复新年份出生牛只不显示的问题",
            "6. <b>功能</b>：新增Sheet 8公牛性状汇总分析报告",
            "7. <b>功能</b>：实现动态性状数据收集功能",
            "8. <b>优化</b>：支持动态识别所有性状列"
        ]
    },
    {
        "version": "1.2.0.12",
        "date": "2025-10-12",
        "author": "Development Team",
        "changes": [
            "1. <b>修复</b>：修复配种记录处理中配种日期丢失问题",
            "2. <b>优化</b>：优化数据填充操作，保护日期列完整性",
            "3. <b>功能</b>：确保配种数据中的日期完整保留"
        ]
    },
    {
        "version": "1.2.0.11",
        "date": "2025-10-12",
        "author": "Development Team",
        "changes": [
            "1. <b>修复</b>：修复所有选配模块的数据列引用错误",
            "2. <b>修复</b>：完全移除旧数据列支持，统一使用新标准",
            "3. <b>修复</b>：修复6个核心模块的选配逻辑",
            "4. <b>优化</b>：简化代码，移除向后兼容逻辑",
            "5. <b>功能</b>：选配功能恢复正常运行",
            "6. <b>优化</b>：清理测试文件，提升代码整洁度",
            "7. <b>界面</b>：修复分析完成弹窗按钮样式不一致问题"
        ]
    },
    {
        "version": "1.2.0.9",
        "date": "2025-10-12",
        "author": "Development Team",
        "changes": [
            "1. <b>修复</b>：核心修复库存管理系统数据结构",
            "2. <b>功能</b>：支持同一公牛多种冻精类型的库存独立管理",
            "3. <b>优化</b>：删除冗余数据列，统一类型标识",
            "4. <b>优化</b>：优化数据预览逻辑，保留所有数据组合",
            "5. <b>功能</b>：使用精确匹配更新库存数据",
            "6. <b>功能</b>：优化分配逻辑，分离库存和遗传数据查询",
            "7. <b>修复</b>：修复数据覆盖导致的库存丢失问题",
            "8. <b>修复</b>：修复类型与库存不匹配的分配错误"
        ]
    },
    {
        "version": "1.2.0.8",
        "date": "2025-10-11",
        "author": "Development Team",
        "changes": [
            "1. <b>功能</b>：完成Excel报告Sheet 5-7生成功能",
            "2. <b>功能</b>：新增配种记录隐性基因分析报告",
            "3. <b>功能</b>：新增配种记录近交系数分析报告",
            "4. <b>功能</b>：新增配种记录详细数据明细报告",
            "5. <b>界面</b>：优化图表颜色，与风险等级对应",
            "6. <b>功能</b>：优化年份趋势表，区分不同风险等级",
            "7. <b>优化</b>：自动化生成页面优化，智能刷新数据列表",
            "8. <b>文档</b>：更新报告生成实施方案文档",
            "9. <b>修复</b>：修复近交系数区间定义"
        ]
    },
    {
        "version": "1.2.0.7",
        "date": "2025-10-10",
        "author": "Development Team",
        "changes": [
            "1. <b>界面</b>：新增对比数据摘要列，显示关键信息",
            "2. <b>功能</b>：优化对比牧场摘要显示格式",
            "3. <b>功能</b>：优化外部参考数据摘要格式",
            "4. <b>修复</b>：修复对比牧场编辑后列表不更新问题",
            "5. <b>修复</b>：修复配置文件缓存不同步问题",
            "6. <b>功能</b>：新增确认按钮，优化操作流程",
            "7. <b>界面</b>：统一确认和关闭按钮样式",
            "8. <b>功能</b>：新增表格双击编辑功能",
            "9. <b>优化</b>：性状值自动保留2位小数",
            "10. <b>优化</b>：优化数据加载逻辑，自动刷新缓存"
        ]
    },
    {
        "version": "1.2.0.6",
        "date": "2025-10-09",
        "author": "Development Team",
        "changes": [
            "1. <b>功能</b>：新增外部参考数据对比功能",
            "2. <b>功能</b>：新增外部参考数据标准模板",
            "3. <b>界面</b>：优化对比牧场管理界面",
            "4. <b>优化</b>：重构报告生成页面，统一管理对比数据",
            "5. <b>功能</b>：支持自定义对比线颜色",
            "6. <b>功能</b>：内置外部参考数据模板",
            "7. <b>修复</b>：修复对比数据加载问题，增强稳定性"
        ]
    },
    {
        "version": "1.2.0.5",
        "date": "2025-10-07",
        "author": "Development Team",
        "changes": [
            "1. <b>文档</b>：建立完整的文档体系",
            "2. <b>功能</b>：优化缺失公牛上传功能",
            "3. <b>界面</b>：简化用户提示信息",
            "4. <b>功能</b>：新增数据库版本显示",
            "5. <b>优化</b>：统一API服务地址",
            "6. <b>文档</b>：创建项目路线图",
            "7. <b>文档</b>：完成已完成任务清单",
            "8. <b>文档</b>：创建待办事项清单",
            "9. <b>优化</b>：整理文档目录结构"
        ]
    },
    {
        "version": "1.2.0.4",
        "date": "2025-09-30",
        "author": "Development Team",
        "changes": [
            "1. <b>修复</b>：修复母牛分配问题，统一ID字段类型",
            "2. <b>界面</b>：优化深色模式支持",
            "3. <b>功能</b>：新增主题管理器",
            "4. <b>修复</b>：修复自动分组对话框显示问题",
            "5. <b>界面</b>：优化深色模式下的文本颜色显示",
            "6. <b>性能</b>：改进程序启动流程",
            "7. <b>修复</b>：修复按钮样式在不同主题下的问题",
            "8. <b>界面</b>：优化预览表格的主题适配"
        ]
    },
    {
        "version": "1.2.0.3",
        "date": "2025-09-27",
        "author": "Development Team",
        "changes": [
            "1. <b>功能</b>：新增分组模式切换功能",
            "2. <b>优化</b>：优化累积报告更新逻辑",
            "3. <b>功能</b>：新增选配预览未分配数量实时更新",
            "4. <b>功能</b>：新增清空选配功能",
            "5. <b>修复</b>：修复数字分组显示问题",
            "6. <b>修复</b>：修复空组不显示问题",
            "7. <b>修复</b>：修复自动分组显示问题",
            "8. <b>修复</b>：修复清空选配时列名错误",
            "9. <b>功能</b>：选配后自动更新分组预览统计",
            "10. <b>优化</b>：改进组别替换逻辑"
        ]
    },
    {
        "version": "1.2.0.2",
        "date": "2025-09-22",
        "author": "Development Team",
        "changes": [
            "1. <b>性能</b>：数据库下载全面迁移到云存储",
            "2. <b>优化</b>：移除中间服务器依赖，直接下载数据",
            "3. <b>功能</b>：实现数据库版本管理",
            "4. <b>功能</b>：新增数据库下载进度条",
            "5. <b>功能</b>：实现下载失败自动重试机制",
            "6. <b>优化</b>：优化文件组织结构",
            "7. <b>优化</b>：日志文件独立目录管理",
            "8. <b>修复</b>：修复版本文件初始化问题",
            "9. <b>优化</b>：优化版本文件管理机制",
            "10. <b>修复</b>：修复边界情况处理",
            "11. <b>优化</b>：构建流程优化"
        ]
    },
    {
        "version": "1.2.0.1",
        "date": "2025-09-22",
        "author": "Development Team",
        "changes": [
            "1. <b>性能</b>：选配算法优化",
            "2. <b>修复</b>：修复公牛育种指数加载问题",
            "3. <b>功能</b>：选配时使用用户计算的育种指数",
            "4. <b>优化</b>：改进错误提示系统",
            "5. <b>优化</b>：优化文件缺失错误消息",
            "6. <b>优化</b>：移除选配过程中的外部依赖",
            "7. <b>功能</b>：完善用户自定义育种指数加载",
            "8. <b>功能</b>：增强云数据库连接",
            "9. <b>性能</b>：优化数据库同步性能"
        ]
    },
    {
        "version": "1.1.2.0",
        "date": "2025-09-21",
        "author": "Development Team",
        "changes": [
            "1. <b>界面</b>：实现缺失公牛数据的预估值标记功能",
            "2. <b>功能</b>：Excel报告中添加数据质量视觉标识",
            "3. <b>优化</b>：优化育种值计算逻辑",
            "4. <b>功能</b>：实现遗传趋势分析和线性插值",
            "5. <b>功能</b>：添加完整格式标记",
            "6. <b>功能</b>：所有公牛性状列支持源数据标记",
            "7. <b>性能</b>：简化计算流程，提升数据处理性能",
            "8. <b>界面</b>：改进数据质量可视化"
        ]
    }
]

# 获取当前版本
def get_version():
    """获取当前版本号"""
    return VERSION

# 获取版本信息
def get_version_info():
    """获取当前版本的完整信息"""
    for v in VERSION_HISTORY:
        if v["version"] == VERSION:
            return v
    # 如果没找到，返回第一个（最新的）
    if VERSION_HISTORY:
        return VERSION_HISTORY[0]
    return None

# 获取版本历史
def get_version_history():
    """获取所有版本历史"""
    return VERSION_HISTORY
