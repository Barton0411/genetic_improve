"""
版本信息管理
"""

# 版本号格式: 主版本号.次版本号.修订号.构建号 (xxx.xxx.xxx.xxx)
VERSION = "1.2.0.5"

# 版本历史
VERSION_HISTORY = [
    {
        "version": "1.2.0.5",
        "date": "2025-10-07",
        "author": "Development Team",
        "changes": [
            "📚 建立完整的文档体系：系统架构、API参考、云服务配置、项目管理",
            "✨ 优化缺失公牛上传功能：上传时即时检查，格式错误保留处理",
            "🎨 简化用户提示信息：移除技术细节，只显示关键信息",
            "📊 新增数据库版本显示：侧边栏显示数据库更新时间",
            "🔧 统一API地址为 https://api.genepop.com",
            "📝 创建项目路线图(ROADMAP)：规划v1.3-v3.0发展方向",
            "✅ 完成已完成任务清单(COMPLETED_TASKS)：85%完成度统计",
            "📋 创建待办事项清单(TODO_LIST)：按优先级分类管理",
            "🗂️ 整理文档目录结构：按功能分类，便于查找和维护"
        ]
    },
    {
        "version": "1.2.0.4",
        "date": "2025-09-30",
        "author": "Development Team",
        "changes": [
            "🔧 修复母牛分配问题：所有ID字段统一使用字符串类型，解决类型不匹配导致的分配失败",
            "🎨 优化深色模式支持：按钮、表格、对话框等UI元素自适应系统主题",
            "✨ 新增主题管理器：实现深色/浅色模式实时检测和样式切换",
            "🔧 修复自动分组对话框在深色模式下的显示问题",
            "🎨 优化遗传缺陷列在深色模式下的文本颜色显示",
            "⚡ 改进程序启动流程，解决数据库更新后可能的卡死问题",
            "🔧 修复牛只指数计算页面按钮在不同主题下的样式问题",
            "📊 优化预览表格的主题适配，确保深色模式下的可读性"
        ]
    },
    {
        "version": "1.2.0.3",
        "date": "2025-09-27",
        "author": "Development Team",
        "changes": [
            "✨ 新增分组模式切换功能：手动分组和自动分组互斥切换",
            "🔄 优化累积报告更新逻辑：实现智能合并，空值不覆盖已有数据",
            "📊 新增选配预览框未分配数量实时更新功能",
            "🧹 新增清空选配功能：可清空所选组的常规和性控选配结果",
            "🔧 修复数字分组显示为'未分组'的问题",
            "🔧 修复空组不显示的问题：使用fillna处理NaN值",
            "🔧 修复自动分组全部显示为'未分组'的问题",
            "🔧 修复清空选配时列名错误：兼容'group'和'分组'列名",
            "📈 选配后自动更新分组预览中的未分配统计",
            "🎯 改进组别替换逻辑：基于首个选择判断是否替换整组"
        ]
    },
    {
        "version": "1.2.0.2",
        "date": "2025-09-22",
        "author": "Development Team",
        "changes": [
            "🚀 数据库下载全面迁移到阿里云OSS，大幅提升下载速度和稳定性",
            "📦 移除API服务器依赖，直接从OSS下载132MB数据库文件",
            "✅ 实现数据库版本管理，支持增量更新检查",
            "📊 新增数据库下载进度条，实时显示MB进度和百分比",
            "🔄 实现下载失败自动重试机制（最多3次），确保数据库下载成功",
            "📁 优化文件组织结构：项目文件在项目目录，配置和缓存在用户目录",
            "📝 日志文件迁移到logs/目录，便于调试和管理",
            "🔧 修复版本文件初始化为0的问题，确保版本号正确",
            "🔄 版本文件跟随数据库位置，避免版本不一致问题",
            "🔧 修复数据库文件丢失但版本文件存在的边界情况",
            "⚡ GitHub Actions构建优化，支持从OSS下载预装数据库"
        ]
    },
    {
        "version": "1.2.0.1",
        "date": "2025-09-22",
        "author": "Development Team",
        "changes": [
            "🚀 重大更新：选配算法优化",
            "🐛 修复公牛育种指数加载KeyError问题",
            "📊 选配时只使用用户计算的育种指数，不再从数据库查询NM$/TPI",
            "🎯 大幅改进错误提示系统，清晰显示缺失文件的完整路径和解决方法",
            "✨ 优化文件缺失错误消息，为每种缺失文件提供具体操作指引",
            "🔧 移除选配过程中的数据库依赖，确保使用用户自定义育种目标",
            "📝 完善用户自定义育种指数（如NM$权重_index）的加载逻辑",
            "🔐 增强云数据库连接，实现从阿里云RDS直接同步数据到本地缓存",
            "⚡ 优化数据库同步性能，支持247,192条记录的快速加载"
        ]
    },
    {
        "version": "1.1.2.0",
        "date": "2025-09-21",
        "author": "Development Team",
        "changes": [
            "🎨 全面实现缺失公牛数据的预估值标记功能",
            "📊 Excel报告中添加数据质量视觉标识（红色：年份预估，灰底黄字：默认值）",
            "🔧 优化育种值计算逻辑，支持预填充估算值",
            "✨ 实现遗传趋势分析和线性插值功能",
            "📈 processed_index_cow_index_scores.xlsx 添加完整格式标记",
            "🎯 所有公牛性状列（sire_*, mgs_*, mmgs_*）支持源数据标记",
            "🚀 简化计算流程，提升数据处理性能",
            "📝 改进数据质量可视化，便于快速识别预估数据"
        ]
    },
    {
        "version": "1.1.0.6",
        "date": "2025-09-20",
        "author": "Development Team",
        "changes": [
            "🐛 修复dam列数据格式问题，保持原始ID格式不变",
            "📊 修复母亲号(dam)从原始Excel读取时前导零丢失问题",
            "🔧 优化ID列数据类型处理，使用原始中文列名指定dtype",
            "✅ 确保cow_id和dam列在处理后保持字符串格式",
            "📝 修复NAAB编号处理时的TypeError问题",
            "🎯 保证ID数据的完整性，支持推送功能正常工作"
        ]
    },
    {
        "version": "1.1.0.5",
        "date": "2025-09-19",
        "author": "Development Team",
        "changes": [
            "📝 重新整理开发文档，突出API配置重要性",
            "🔧 优化文档结构和格式，提高可读性",
            "✅ 确认客户端完全移除数据库密码",
            "📌 明确下一阶段开发任务优先级",
            "🎯 准备多牧场数据集成方案"
        ]
    },
    {
        "version": "1.1.0.4",
        "date": "2025-09-19",
        "author": "Development Team",
        "changes": [
            "🔧 修复缺失公牛上传401认证错误",
            "🚀 数据API端点移除认证要求，简化调用流程",
            "📡 完成生产环境API部署和服务配置",
            "✅ 统一JWT密钥，确保认证一致性",
            "🔄 优化API客户端代理设置，解决网络连接问题",
            "📝 更新开发文档，添加详细API部署状态"
        ]
    },
    {
        "version": "1.1.0.3",
        "date": "2025-09-19",
        "author": "Development Team",
        "changes": [
            "⚡ 大幅优化推荐矩阵生成性能，速度提升60%+",
            "🚀 使用NumPy向量化计算替代双重循环",
            "📊 添加详细进度显示 (xxx/xxxx头)",
            "💾 预构建查找字典，加速数据查询",
            "🔧 优化内存使用，减少重复计算",
            "🎯 进度更新策略优化，提升用户体验"
        ]
    },
    {
        "version": "1.1.0.2",
        "date": "2025-09-19",
        "author": "Development Team",
        "changes": [
            "🚀 实现QThread多线程后台执行选配，UI不再卡顿",
            "📊 添加选配进度对话框，实时显示处理进度",
            "⚡ 优化数据加载流程，提前过滤无效公牛",
            "🔧 避免重复检查无效数据，提升性能30%",
            "🎯 支持取消正在执行的选配任务",
            "💡 改进用户体验，界面保持流畅响应"
        ]
    },
    {
        "version": "1.1.0.1",
        "date": "2025-09-19",
        "author": "Development Team",
        "changes": [
            "🐛 修复个体选配中常规公牛无法分配的问题",
            "✨ 增强推荐矩阵生成时的数据验证",
            "🔍 在推荐生成阶段过滤无库存和无数据的公牛",
            "📊 新增公牛数据质量检查报告",
            "🛡️ 提升系统容错性，防止无效数据导致分配失败",
            "📝 优化日志输出，提供更详细的数据筛选信息"
        ]
    },
    {
        "version": "1.1.0.0",
        "date": "2025-09-17",
        "author": "Development Team",
        "changes": [
            "1. 重大版本发布：完整自动更新机制，用户无需自行下载",
            "2. 支持跨平台运行（Windows/macOS）",
            "3. 支持近交系数计算，采用6代系谱通经法计算",
            "4. 支持个体选配自动分组",
            "5. 支持备注选配时部分牛只无选配的原因呈现",
            "6. 本次重构后，自动化生产报告模块，暂未开放",
            "7. 本次重构后，体型外貌鉴定自动分析模块，暂未开放"
        ]
    },
    {
        "version": "1.0.9.14",
        "date": "2025-09-17",
        "author": "Development Team",
        "changes": [
            "🔧 修正强制更新对话框关闭行为",
            "🚪 关闭更新窗口现在正确退出整个程序",
            "📝 更新确认对话框提示信息，明确说明关闭将退出程序",
            "🎯 优化程序退出逻辑，确保资源正确释放",
            "💡 澄清强制更新的正确行为：更新或退出"
        ]
    },
    {
        "version": "1.0.9.13",
        "date": "2025-09-17",
        "author": "Development Team",
        "changes": [
            "✨ 为强制更新对话框添加关闭按钮",
            "🔒 增加关闭确认机制，防止意外跳过重要更新",
            "⌨️ 支持ESC键关闭对话框（需确认）",
            "🎯 优化用户体验，提供更多操作选择",
            "📝 改进关闭提示信息，说明跳过更新的风险"
        ]
    },
    {
        "version": "1.0.9.12",
        "date": "2025-09-17",
        "author": "Development Team",
        "changes": [
            "🔍 增强版本更新检查日志记录",
            "🐛 修复Windows平台版本检查问题诊断",
            "📊 添加详细的版本检查流程跟踪",
            "🛠️ 改进错误信息和调试输出",
            "⚡ 优化版本管理器初始化流程",
            "🔒 增强异常处理和错误报告"
        ]
    },
    {
        "version": "1.0.9.11",
        "date": "2025-09-17",
        "author": "Development Team",
        "changes": [
            "🔥 macOS改为手动拖拽安装，避免应用崩溃",
            "⚡ 移除自动删除复制逻辑，防止应用包损坏",
            "🛡️ 利用macOS原生应用替换机制",
            "🎯 简化安装流程，提升用户体验",
            "🔒 修复QtCore模块内存访问崩溃问题",
            "📦 保持DMG挂载状态便于用户操作",
            "🌙 优化手动安装指导显示",
            "🚀 同时支持Windows和macOS平台打包"
        ]
    },
    {
        "version": "1.0.9.10",
        "date": "2025-09-17",
        "author": "Development Team",
        "changes": [
            "🔥 完整实现应用内自动更新系统",
            "⚡ 真实下载功能替代模拟进度条",
            "🛡️ 智能DMG挂载和应用识别机制",
            "🎯 通用应用名称识别，无需硬编码",
            "🔒 多重安全验证避免误操作其他应用",
            "🎨 完全无需密码输入的权限处理",
            "📦 支持完全自动安装和重启",
            "🌙 修复暗色模式下手动安装指导显示问题",
            "🚀 端到端自动更新流程验证完成"
        ]
    },
    {
        "version": "1.0.9.9",
        "date": "2025-09-17",
        "author": "Development Team",
        "changes": [
            "🔥 完整实现应用内自动更新系统",
            "⚡ 真实下载功能替代模拟进度条",
            "🛡️ 智能DMG挂载和应用识别机制",
            "🎯 通用应用名称识别，无需硬编码",
            "🔒 多重安全验证避免误操作其他应用",
            "🎨 GUI权限对话框避免终端密码卡死",
            "📦 支持完全自动安装和重启",
            "🚀 端到端自动更新流程验证完成"
        ]
    },
    {
        "version": "1.0.5.2",
        "date": "2025-09-16",
        "author": "Development Team",
        "changes": [
            "调整近交系数默认阈值从3.125%改为6.25%",
            "优化选配约束条件，提供更多选配组合",
            "更新GUI界面默认选择为6.25%阈值",
            "完善个体选配和完整选配的默认参数"
        ]
    },
    {
        "version": "1.0.5.1",
        "date": "2025-09-16",
        "author": "Development Team",
        "changes": [
            "测试GitHub Actions自动构建流程",
            "验证强制更新系统完整功能",
            "OSS自动扫描API集成测试",
            "自动生成changelog并上传到OSS",
            "端到端自动化部署流程验证"
        ]
    },
    {
        "version": "1.0.6",
        "date": "2025-09-16",
        "author": "Development Team", 
        "changes": [
            "🔥 实现强制更新系统，确保关键更新必须安装",
            "⚡ 新增应用内智能更新功能，无需手动下载安装包",
            "🛡️ 增强更新安全性，支持完整文件替换和回滚机制",
            "🎨 全新设计的更新对话框，支持深色/浅色模式自动适配",
            "📦 智能路径检测，支持任意安装位置的程序更新",
            "🔒 保护用户数据，更新过程中项目文件和配置安全不受影响",
            "🚀 三阶段更新流程：准备→执行→验证，确保更新可靠性",
            "💻 跨平台兼容，完美支持Windows、macOS和Linux系统"
        ]
    },
    {
        "version": "1.0.5",
        "date": "2025-09-16",
        "author": "Development Team",
        "changes": [
            "完善版本自动更新系统，支持GUI对话框选择下载",
            "修复版本检查服务器连接逻辑，增加备用服务器支持",
            "优化下载URL获取机制，直接从版本信息API响应中提取",
            "更新PyQt6更新对话框，替换原有tkinter实现避免崩溃",
            "更新全面的系统文档和部署指南",
            "优化requirements.txt依赖版本和兼容性",
            "为明日API化数据库连接做准备，提升安全性"
        ]
    },
    {
        "version": "1.0.4",
        "date": "2025-09-15",
        "author": "Development Team",
        "changes": [
            "优化个体选配报告生成性能，添加约束数据缓存机制",
            "实现选配备注系统，详细说明约束过滤情况",
            "新增近交系数和隐性基因约束分析功能",
            "修复备注格式，去除冗余前缀文字",
            "大幅提升报告生成速度，减少文件I/O操作",
            "增强约束分析准确性，支持跳过优质公牛的详细说明"
        ]
    },
    {
        "version": "1.0.3",
        "date": "2025-08-27",
        "author": "Development Team",
        "changes": [
            "修复后代近交系数排序问题，优先按后代近交系数降序排序",
            "修复血缘图滚轮缩放时图形消失问题，添加缩放边界检查",
            "禁止缩放血缘图标题，保持标题大小固定",
            "添加代数选择按钮，支持2-6代血缘图显示",
            "增大血缘图字体大小，提高可读性",
            "降低滚轮缩放敏感度，减少单次缩放幅度",
            "修复缩放中心固定为血缘图正中心，防止图形移动",
            "完全禁用简易系谱图的拖动功能，只保留双击查看详细视图",
            "扩展代数选择范围为2-6代，字体大小自动适配框的大小",
            "移除适应内容按钮，简化用户界面"
        ]
    },
    {
        "version": "1.0.2",
        "date": "2025-08-08",
        "author": "Development Team",
        "changes": [
            "优化冻精分配算法，先给排名高的母牛分配排名高的公牛",
            "加载公牛指数得分用于计算后代得分",
            "根据后代得分排序公牛，确保高分母牛优先获得高分公牛",
            "修复冻精预览表列宽问题，冻精编号显示完整",
            "添加育种项目管理文件双击打开和右键菜单功能"
        ]
    },
    {
        "version": "1.0.1",
        "date": "2025-07-29",
        "author": "Development Team",
        "changes": [
            "重大改进PPT生成功能",
            "新增母牛关键性状详情分析页",
            "新增公牛育种指数排名页",
            "新增年度遗传进展趋势页",
            "新增近交系数风险分析页",
            "新增隐性基因筛查统计页",
            "新增选配推荐详情示例页",
            "新增项目总结与改良建议页",
            "优化PPT页面布局和数据展示",
            "增强PPT内容的完整性和专业性",
            "修复数据库DNS解析问题，使用IP地址直连",
            "更新requirements.txt，添加所有缺失的依赖项",
            "修复opencv-python、networkx、scikit-learn依赖缺失问题"
        ]
    },
    {
        "version": "1.0.0",
        "date": "2025-07-28",
        "author": "Development Team",
        "changes": [
            "初始版本发布",
            "实现育种项目管理功能",
            "实现数据上传功能（母牛、公牛、配种记录、体型外貌、基因组数据）",
            "实现关键育种性状分析",
            "实现牛只指数计算排名",
            "实现近交系数及隐性基因分析",
            "实现个体选配功能",
            "实现选配推荐报告生成（包含后代得分预测）",
            "实现PPT自动报告生成",
            "集成阿里云数据库",
            "优化UI界面和用户体验"
        ]
    }
]

# 获取当前版本
def get_version():
    """获取当前版本号"""
    return VERSION

# 获取版本信息
def get_version_info():
    """获取当前版本的完整信息"""
    for v in VERSION_HISTORY:
        if v["version"] == VERSION:
            return v
    # 如果没找到，返回第一个（最新的）
    if VERSION_HISTORY:
        return VERSION_HISTORY[0]
    return None

# 获取版本历史
def get_version_history():
    """获取所有版本历史"""
    return VERSION_HISTORY