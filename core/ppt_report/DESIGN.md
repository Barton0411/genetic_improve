# PPT报告生成系统设计文档 v2.0

## 📋 项目概述

从Excel综合报告（20个Sheet）生成专业的PPT演示文稿，排除明细表，重点展示分析结果和数据洞察。

---

## 🎯 核心特性

1. **详细但不冗余**：包含15个有价值的Sheet内容，排除5个明细表
2. **数据可视化**：使用matplotlib/seaborn生成专业图表
3. **智能评论**：每页自动生成简短的数据分析评论
4. **模块化设计**：7个部分独立开发，易于维护扩展
5. **使用现有模板**：基于`PPT模版.pptx`的母版布局

---

## 📊 PPT结构 (约44页)

### 第一部分: 封面与导航 (2页)
- Slide 1: 封面
- Slide 2: 目录

### 第二部分: 牧场概况 (4-5页)
- Slide 3: 章节页 "牧场概况"
- Slide 4: 牧场基本信息 (Sheet 1)
- Slide 5: 牛群结构分析

### 第三部分: 系谱记录分析 (5-6页)
- Slide 6: 章节页 "系谱记录分析"
- Slide 7-9: 系谱完整性统计、趋势、对比 (Sheet 3)

### 第四部分: 育种性状与遗传评估 (12-15页)
- Slide 10: 章节页 "牛群遗传评估"
- Slide 11-19: 关键性状、TPI/NM$分布、年度趋势、母牛排名 (Sheet 5-9)

### 第五部分: 配种记录分析 (7-9页)
- Slide 20: 章节页 "配种记录分析"
- Slide 21-25: 配种概况、基因风险、近交分析 (Sheet 11-12)

### 第六部分: 公牛使用分析 (10-12页)
- Slide 26: 章节页 "公牛使用分析"
- Slide 27-35: 已用公牛、备选公牛分析 (Sheet 14-18)

### 第七部分: 选配推荐方案 (4-5页)
- Slide 36: 章节页 "选配推荐方案"
- Slide 37-39: 选配统计、质量评估 (Sheet 20)

### 第八部分: 总结与建议 (4-5页)
- Slide 40: 章节页 "项目总结与建议"
- Slide 41-44: 主要发现、改良建议、结束页

---

## 🏗️ 技术架构

```
core/ppt_report/
├── __init__.py              # 模块初始化
├── config.py                # 配置参数（颜色、字体、布局）
├── utils.py                 # 工具函数
├── data_collector.py        # 数据收集器（从Excel读取）
├── chart_creator.py         # 图表生成器（matplotlib/seaborn）
├── generator.py             # 主生成器类
├── slide_builders/          # 幻灯片构建器模块
│   ├── __init__.py
│   ├── base_builder.py      # 基础构建器类
│   ├── part1_overview.py    # 第一部分：牧场概况
│   ├── part2_pedigree.py    # 第二部分：系谱分析
│   ├── part3_genetics.py    # 第三部分：遗传评估
│   ├── part4_breeding.py    # 第四部分：配种记录
│   ├── part5_bulls.py       # 第五部分：公牛使用
│   ├── part6_mating.py      # 第六部分：选配推荐
│   └── part7_summary.py     # 第七部分：总结建议
└── DESIGN.md                # 本设计文档
```

---

## 🎨 图表生成策略

### 推荐方案：Python matplotlib/seaborn

**流程**:
```
数据 → matplotlib/seaborn → PNG图片(300dpi) → 嵌入PPT
```

**图表类型**:
1. **柱状图** (Bar Chart) - 分段统计、对比分析
2. **折线图** (Line Chart) - 年度趋势、遗传进展
3. **饼图** (Pie Chart) - 比例分布、风险等级
4. **直方图** (Histogram) - TPI/NM$分布、正态曲线
5. **箱线图** (Box Plot) - 数据分布、离群值
6. **散点图** (Scatter Plot) - TPI vs NM$ 相关性
7. **水平条形图** (Horizontal Bar) - 公牛对比、排名

**配色方案**:
- 主题色：蓝色 (#0070C0)
- 强调色：橙色 (#FFC000)
- 风险色：绿/黄/橙/红

---

## 💬 评论生成策略

每页（除标题和章节页）都包含**评论框**，位于页面底部。

### 评论内容类型：

1. **描述性评论**：总结本页关键数据
   ```
   示例："系谱完整性较好，父号识别率达95.3%，但外祖父识别率仅62.1%，建议加强外祖父信息录入。"
   ```

2. **评价性评论**：对数据质量进行评估
   ```
   示例："牛群TPI均值2789分，高于全国平均水平，整体遗传潜力较强。"
   ```

3. **建议性评论**：提出改进方向
   ```
   示例："建议优先淘汰TPI<2400分的低指数母牛（占比15.2%），加快群体改良速度。"
   ```

4. **风险性评论**：识别潜在风险
   ```
   示例："配种记录中有12.3%的近交系数>6.25%，需要加强近交控制。"
   ```

### 评论生成逻辑：

在每个SlideBuilder中实现 `generate_comment()` 方法，根据数据自动生成评论。

---

## 🔄 分阶段实施计划

### Phase 1: 基础框架与牧场概况 ✅ (正在进行)
- [x] 创建配置文件 (`config.py`)
- [x] 创建工具函数 (`utils.py`)
- [x] 创建数据收集器 (`data_collector.py`)
- [ ] 创建图表生成器 (`chart_creator.py`)
- [ ] 创建基础构建器 (`base_builder.py`)
- [ ] 实现封面和目录
- [ ] 实现牧场概况部分 (`part1_overview.py`)
- [ ] 测试 Phase 1

### Phase 2: 系谱记录分析
- [ ] 实现系谱分析部分 (`part2_pedigree.py`)
- [ ] 生成系谱相关图表
- [ ] 测试 Phase 2

### Phase 3: 育种性状与遗传评估
- [ ] 实现遗传评估部分 (`part3_genetics.py`)
- [ ] 生成性状分布图表
- [ ] 生成年度趋势图表
- [ ] 测试 Phase 3

### Phase 4: 配种记录分析
- [ ] 实现配种分析部分 (`part4_breeding.py`)
- [ ] 生成基因风险图表
- [ ] 生成近交分布图表
- [ ] 测试 Phase 4

### Phase 5: 公牛使用分析
- [ ] 实现公牛分析部分 (`part5_bulls.py`)
- [ ] 生成公牛对比图表
- [ ] 测试 Phase 5

### Phase 6: 选配推荐
- [ ] 实现选配推荐部分 (`part6_mating.py`)
- [ ] 生成选配统计图表
- [ ] 测试 Phase 6

### Phase 7: 总结与建议
- [ ] 实现总结部分 (`part7_summary.py`)
- [ ] 生成综合分析
- [ ] 整体测试与优化

---

## 🎯 下一步行动

**当前任务**: Phase 1 - 基础框架与牧场概况

**需要完成**:
1. 创建图表生成器 (`chart_creator.py`)
2. 创建基础构建器 (`base_builder.py`)
3. 实现主生成器 (`generator.py`)
4. 实现 `part1_overview.py`
5. 测试生成前5页PPT

**预计时间**: 1-2小时

---

## 📝 备注

- 使用现有PPT模板 `/Users/bozhenwang/projects/mating/genetic_improve/PPT模版.pptx`
- 布局索引：0=封面, 1=间隔页, 2=正文页1, 3=正文页2, 4=图片页
- 图表保存在临时目录，生成完PPT后自动清理
- 评论字号12pt，灰色，位于页面底部
